
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>16. λ°±ν…μ¤ν… μ‹λ®¬λ μ΄μ…</title>
    
  <link rel="stylesheet" href="_static/css/index.f658d18f9b420779cfdf24aa0a7e2d77.css">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="_static/sphinx-book-theme.40e2e510f6b7d1648584402491bb10fe.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.d3f166471bb80abb5163.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script async="async" kind="hypothesis" src="https://hypothes.is/embed.js"></script>
    <script kind="utterances">

    var commentsRunWhenDOMLoaded = cb => {
    if (document.readyState != 'loading') {
        cb()
    } else if (document.addEventListener) {
        document.addEventListener('DOMContentLoaded', cb)
    } else {
        document.attachEvent('onreadystatechange', function() {
        if (document.readyState == 'complete') cb()
        })
    }
}

var addUtterances = () => {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src = "https://utteranc.es/client.js";
    script.async = "async";

    script.setAttribute("repo", "hyunyulhenry/quant_python");
    script.setAttribute("issue-term", "pathname");
    script.setAttribute("theme", "github-light");
    script.setAttribute("label", "π’¬ comment");
    script.setAttribute("crossorigin", "anonymous");

    sections = document.querySelectorAll("div.section");
    if (sections !== null) {
        section = sections[sections.length-1];
        section.appendChild(script);
    }
}
commentsRunWhenDOMLoaded(addUtterances);
</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.d31b09fe5c1d09cb49b26a786de4a05d.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="15. νΈλ μ΄λ”© μ „λµμ„ μ„ν• κΈ°μ μ  μ§€ν‘" href="15_trading.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="index.html">
  
  <img src="_static/logo.png" class="logo" alt="logo">
  
  
</a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>
<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="index.html">
   νμ΄μ¬μ„ μ΄μ©ν• ν€€νΈ ν¬μ ν¬νΈν΄λ¦¬μ¤ λ§λ“¤κΈ°
  </a>
 </li>
</ul>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="01_data_programming.html">
   1. ν€€νΈ ν¬μμ μ‹¬μ¥: λ°μ΄ν„°μ™€ ν”„λ΅κ·Έλλ°
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="02_information.html">
   2. ν¬λ΅¤λ§μ„ μ„ν• κΈ°λ³Έ μ§€μ‹
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="03_api.html">
   3. APIλ¥Ό μ΄μ©ν• λ°μ΄ν„° μμ§‘
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="04_crawl.html">
   4. ν¬λ΅¤λ§ μ΄ν•΄ν•κΈ°
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="05_crawl_practice.html">
   5. κΈμµ λ°μ΄ν„° μμ§‘ν•κΈ° (κΈ°λ³Έ)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="06_crawl_actual.html">
   6. κΈμµ λ°μ΄ν„° μμ§‘ν•κΈ° (μ‹¬ν™”)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="07_hts_api.html">
   7. μ¦κ¶μ‚¬ API μ—°κ²° λ° λ§¤λ§¤
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="08_us_data.html">
   8. λ―Έκµ­ μ£Όμ‹ λ°μ΄ν„° μμ§‘ν•κΈ°
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="09_other_data.html">
   9. ν¬μ μ°Έκ³ μ© λ°μ΄ν„° μμ§‘ν•κΈ°
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="10_bind_data.html">
   10. λ°μ΄ν„° μ •λ¦¬ν•κΈ°
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="11_data_analysis.html">
   11. λ°μ΄ν„° λ¶„μ„ λ° μ‹κ°ν™”ν•κΈ°
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="12_factor_basic.html">
   12. ν€€νΈ μ „λµμ„ μ΄μ©ν• μΆ…λ©μ„ μ • (κΈ°λ³Έ)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="13_factor_advanced.html">
   13. ν€€νΈ μ „λµμ„ μ΄μ©ν• μΆ…λ©μ„ μ • (μ‹¬ν™”)
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="14_portfolio.html">
   14. ν¬νΈν΄λ¦¬μ¤ κµ¬μ„± μ „λµ
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="15_trading.html">
   15. νΈλ μ΄λ”© μ „λµμ„ μ„ν• κΈ°μ μ  μ§€ν‘
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   16. λ°±ν…μ¤ν… μ‹λ®¬λ μ΄μ…
  </a>
 </li>
</ul>

</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/16_backtest.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

        <!-- Source interaction buttons -->


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
                title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/hyunyulhenry/quant_python/master?urlpath=tree/16_backtest.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#bt">
   16.1 bt ν¨ν‚¤μ§€
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id2">
     16.1.1 κ°€κ²© λ°μ΄ν„°μ μμ§‘
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id3">
     16.1.2 μ „λµμ μ •μ
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id4">
     16.1.3 μ „λµμ λ°±ν…μ¤νΈ
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id5">
   16.1.4 κ²°κ³Όμ— λ€ν• ν‰κ°€
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id6">
   16.2 μ •μ  μμ‚°λ°°λ¶„: μ¬μ›¨λ” ν¬νΈν΄λ¦¬μ¤
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id7">
     16.2.1 μ¬μ›¨λ” ν¬νΈν΄λ¦¬μ¤ λ°±ν…μ¤νΈ
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id8">
   16.3 λ™μ  μμ‚°λ°°λ¶„
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id9">
     16.3.1 λ™μ  μμ‚°λ°°λ¶„ λ°±ν…μ¤νΈΒ¶
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id10">
     16.3.2 κ±°λ λΉ„μ© κ³ λ ¤ν•κΈ°
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id11">
   16.4 μ¶”μ„Έμ¶”μΆ… μ „λµ λ°±ν…μ¤νΈ
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id12">
     16.4.1 λ§μΌ“ νƒ€μ΄λ° μ „λµ
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id13">
     16.4.2 νλΌλ―Έν„° μµμ ν™”
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id14">
     16.4.3 λ΅±μ μ „λµ
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#id15">
   16.5 ν‰κ· νκ·€ μ „λµ λ°±ν…μ¤νΈ
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#rsi">
     16.5.1 RSIλ¥Ό μ΄μ©ν• μ „λµ
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id16">
     16.5.2 λ³Όλ¦°μ € λ°΄λ“λ¥Ό μ΄μ©ν• μ „λµ
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#target-volatility">
   16.6 νƒ€κ² λ³Ό(Target Volatility) μ „λµ
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id17">
     16.6.1 νƒ€κ²λ³Ό κµ¬ν„ν•κΈ°
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#id18">
     16.6.2 μΊ΅ μ”μ°κΈ°
    </a>
   </li>
  </ul>
 </li>
</ul>

        </nav>
        
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="id1">
<h1>16. λ°±ν…μ¤ν… μ‹λ®¬λ μ΄μ…<a class="headerlink" href="#id1" title="Permalink to this headline">Β¶</a></h1>
<p>λ°±ν…μ¤νΈλ€ ν„μ¬ μƒκ°ν•λ” μ „λµμ„ κ³Όκ±°λ¶€ν„° μ‹¤ν–‰ν–μ„ λ• μ–΄λ– ν• μ„±κ³Όκ°€ λ°μƒν•λ”μ§€ ν…μ¤νΈν•΄λ³΄λ” κ³Όμ •μ…λ‹λ‹¤. κ³Όκ±°μ λ°μ΄ν„°λ¥Ό κΈ°λ°μΌλ΅ μ „λµμ„ μ‹¤ν–‰ν•λ” ν€€νΈ ν¬μμ— μμ–΄μ„ μ΄λ” ν•µμ‹¬ λ‹¨κ³„μ΄κΈ°λ„ ν•©λ‹λ‹¤. λ°±ν…μ¤νΈ κ²°κ³Όλ¥Ό ν†µν•΄ ν•΄λ‹Ή μ „λµμ μ†μµλΏλ§ μ•„λ‹λΌ κ°μΆ… μ„ν—μ„ λ€λµμ μΌλ΅ νλ‹¨ν•  μ μμΌλ©°, μ–΄λ–¤ κµ¬κ°„μ—μ„ μ „λµμ΄ μΆ‹μ•λ”μ§€ νΉμ€ λ‚λΉ΄λ”μ§€μ— λ€ν• μ΄ν•΄λ„ ν‚¤μΈ μ μμµλ‹λ‹¤. μ΄λ¬ν• μ΄ν•΄λ¥Ό λ°”νƒ•μΌλ΅ ν€€νΈ ν¬μλ¥Ό μ§€μ†ν•λ‹¤λ©΄ λ‹¨κΈ°μ μΌλ΅ μμµμ΄ λ‚μ κµ¬κ°„μ—μ„λ„ κ·Έ μ΄μ μ— λ€ν• κ°κ΄€μ μΈ μ•λ©μ„ ν‚¤μΈ μ μμΌλ©°, ν™•μ‹ μ„ κ°€μ§€κ³  μ „λµμ„ μ§€μ†ν•  μ μμµλ‹λ‹¤.</p>
<p>κ·Έλ¬λ‚ λ°±ν…μ¤νΈλ¥Ό μ•„λ¬΄λ¦¬ λ³΄μμ μΌλ΅ νΉμ€ μ—„λ°€ν•κ² μ§„ν–‰ν•λ”λΌλ„ μ΄λ―Έ μΌμ–΄λ‚ κ²°κ³Όλ¥Ό λ€μƒμΌλ΅ ν•λ‹¤λ” μ‚¬μ‹¤μ€ λ³€ν•μ§€ μ•μµλ‹λ‹¤. λ°±ν…μ¤νΈ μμµλ¥ λ§μ„ λ³΄κ³  ν¬μμ— λ€ν•΄ νλ‹¨ν•κ±°λ‚, νΉμ€ λ™μΌν• μμµλ¥ μ΄ λ―Έλμ—λ„ λ°λ³µλ  κ²ƒμ΄λΌκ³  λ―Ώλ”λ‹¤λ©΄ μ΄λ” λ°±λ―Έλ¬λ§ λ³΄κ³  μ΄μ „ν•λ” κ²ƒμ²λΌ λ§¤μ° μ„ν—ν• κ²°κ³Όλ¥Ό μ΄λν•  μλ„ μμµλ‹λ‹¤.</p>
<p>νμ΄μ¬μ—λ” λ°±ν…μ¤νΈλ¥Ό μ„ν• μλ§μ€ ν¨ν‚¤μ§€λ“¤μ΄ μ΅΄μ¬ν•μ§€λ§ λ€ν‘μ μΈ ν¨ν‚¤μ§€λ” λ‹¤μκ³Ό κ°™μµλ‹λ‹¤.</p>
<ul class="simple">
<li><p>backtesting: κ°μΆ… νΈλ μ΄λ”© μ „λµμ— μµμ ν™”λ μΈν„°νμ΄μ¤λ¥Ό μ κ³µν•λ©°, μ•μ„ μ‚΄ν΄λ³Έ TA-Lib ν¨ν‚¤μ§€μ™€μ μƒλ‹Ήν• νΈν™μ„± λ° νλΌλ―Έν„°μ— λ€ν• μµμ ν™” κΈ°λ¥λ„ μ κ³µν•©λ‹λ‹¤.</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">kernc</span><span class="o">.</span><span class="n">github</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">backtesting</span><span class="o">.</span><span class="n">py</span><span class="o">/</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Backtrader: κµ¬κΈ€μ—μ„ νμ΄μ¬ κ΄€λ ¨ λ°±ν…μ¤νΈλ¥Ό κ²€μƒ‰ν•λ©΄ κ°€μ¥ λ§μ΄ κ²€μƒ‰λλ” ν¨ν‚¤μ§€μΌ λ§νΌ μ‚¬μ©λ²•μ— λ€ν• λ©”λ‰΄μ–Όμ΄ μ κµ¬μ„±λμ–΄ μμµλ‹λ‹¤.</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">backtrader</span><span class="o">.</span><span class="n">com</span><span class="o">/</span>
</pre></div>
</div>
<ul class="simple">
<li><p>bt: μ•μ ν¨ν‚¤μ§€λ“¤κ³Όλ” λ‹¤λ¥΄κ² νΈλ μ΄λ”© μ „λµ λΏλ§ μ•„λ‹λΌ ν¬νΈν΄λ¦¬μ¤ κΈ°λ°μ ν€€νΈλ¥Ό λ°±ν…μ¤νΈλ¥Ό ν•λ”λ°λ„ λ§¤μ° μ μ©ν• κΈ°λ¥λ“¤μ„ μ κ³µν•©λ‹λ‹¤.</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">pmorissette</span><span class="o">.</span><span class="n">github</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">bt</span><span class="o">/</span>
</pre></div>
</div>
<p>λ¨λ“  ν¨ν‚¤μ§€μ—λ” μ¥λ‹¨μ μ΄ μκΈ° λ§λ ¨μ΄κΈ°μ—, λ¨λ‘ μ‚¬μ©ν•΄λ³΄κ³  λ³ΈμΈμ—κ² λ§λ”κ²ƒμ„ μ„ νƒν•λ” κ²ƒμ΄ μµκ³ μ λ°©λ²•μ…λ‹λ‹¤. λ³Έ μ±…μ—μ„λ” ν¬νΈν΄λ¦¬μ¤ μ „λµκ³Ό νΈλ μ΄λ”© μ „λµμ„ λ™μ‹μ— λ‹¤λ£¨κΈ°μ— <strong>bt</strong> ν¨ν‚¤μ§€λ¥Ό μ‚¬μ©ν•΄ λ°±ν…μ¤νΈλ¥Ό ν•λ„λ΅ ν•κ² μµλ‹λ‹¤. ν•΄λ‹Ή ν¨ν‚¤μ§€μ—λ” λ³Έ μ±…μ—μ„ λ‹¤λ£¨λ” λ‚΄μ© μ™Έμ—λ„ λ°±ν…μ¤νΈ λ° κ²°κ³Ό ν‰κ°€μ— λ€ν• μλ§μ€ ν•¨μλ“¤μ΄ μ΅΄μ¬ν•κΈ°μ—, κ³µμ‹ νμ΄μ§€μ™€ githubμ μ½”λ“λ¥Ό λ¨λ‘λ‹¤ λ―μ–΄λ³΄λ” κ²ƒλ„ μ¬λ°λ” μ‘μ—…μ…λ‹λ‹¤.</p>
<p>λν• λ³Έ ν¨ν‚¤μ§€μ ν•¨μλ” λ€λ¶€λ¶„ <strong>ffn</strong> ν¨ν‚¤μ§€λ¥Ό κΈ°μ΄λ΅ ν•λ―€λ΅ μ΄ μ—­μ‹ μ°Ύμ•„λ³΄λ” κ²ƒμ΄ μ¶”μ²λ“λ¦½λ‹λ‹¤.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">pmorissette</span><span class="o">.</span><span class="n">github</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">ffn</span><span class="o">/</span>
</pre></div>
</div>
<div class="section" id="bt">
<h2>16.1 bt ν¨ν‚¤μ§€<a class="headerlink" href="#bt" title="Permalink to this headline">Β¶</a></h2>
<p>bt ν¨ν‚¤μ§€μ—μ„λ” λ°±ν…μ¤νΈμ κ³Όμ •μ„ λ‹¤μκ³Ό κ°™μ΄ μ •μν•©λ‹λ‹¤.</p>
<ol class="simple">
<li><p>κ°€κ²© λ°μ΄ν„°μ μμ§‘</p></li>
<li><p>μ „λµμ μ •μ</p></li>
<li><p>λ°μ΄ν„°λ¥Ό μ΄μ©ν• μ „λµμ λ°±ν…μ¤νΈ</p></li>
<li><p>κ²°κ³Όμ— λ€ν• ν‰κ°€</p></li>
</ol>
<p>μ΄ μ¤‘ λ³Έ μ¥μ—μ„λ” 1λ²μ—μ„ 3λ²κΉμ§€μ κ³Όμ •μ— λ€ν•΄ μμ„Έν λ‹¤λ£¨λ„λ΅ ν•κ² μΌλ©°, 4λ² κ²°κ³Όμ— λ€ν• ν‰κ°€λ” λ³Έ μ¥μ—μ„λ” κ°„λµν•κ² λ‹¤λ£¨λ©°, λ‹¤μμ¥μ—μ„ λ”μ± μμ„Έν λ‹¤λ£¨λ„λ΅ ν•κ°°μµλ‹λ‹¤.</p>
<div class="section" id="id2">
<h3>16.1.1 κ°€κ²© λ°μ΄ν„°μ μμ§‘<a class="headerlink" href="#id2" title="Permalink to this headline">Β¶</a></h3>
<p>λ°±ν…μ¤νΈλ¥Ό μ„ν•΄μ„λ” λ¨Όμ € κ°€κ²© λ°μ΄ν„°λ¥Ό μ¤€λΉ„ν•΄μ•Ό ν•©λ‹λ‹¤. bt ν¨ν‚¤μ§€μ <code class="docutils literal notranslate"><span class="pre">get()</span></code> ν•¨μλ” μ•Όν›„ νμ΄λ‚Έμ¤ APIλ¥Ό μ΄μ©ν•΄ μμ •μ£Όκ°€λ¥Ό λ‹¤μ΄λ΅λ“ λ°›μ„ μ μκ² ν•΄μ¤λ‹λ‹¤.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">bt</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SPY, TLT&quot;</span><span class="p">,</span> <span class="n">start</span> <span class="o">=</span> <span class="s1">&#39;2003-01-01&#39;</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="s1">&#39;2020-12-31&#39;</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>spy</th>
      <th>tlt</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2002-12-31</th>
      <td>61.700169</td>
      <td>47.430649</td>
    </tr>
    <tr>
      <th>2003-01-02</th>
      <td>63.686214</td>
      <td>46.204308</td>
    </tr>
    <tr>
      <th>2003-01-03</th>
      <td>63.882019</td>
      <td>46.311401</td>
    </tr>
    <tr>
      <th>2003-01-06</th>
      <td>65.007927</td>
      <td>46.188263</td>
    </tr>
    <tr>
      <th>2003-01-07</th>
      <td>64.847061</td>
      <td>46.354237</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">get()</span></code> ν¨ν‚¤μ§€ λ‚΄μ— λ‹¤μ΄λ΅λ“ λ°›κ³ μ ν•λ” μΆ…λ©μ ν‹°μ»¤λ¥Ό μ…λ ¥ν•λ©΄ μμ •μ£Όκ°€λ§ λ°μ΄ν„°ν”„λ μ„ ν•νƒλ΅ κ°€κ³µλ©λ‹λ‹¤. λ¬Όλ΅  μ•μ—μ„ μ‚΄ν΄λ³Έ ν¬λ΅¤λ§, API λ“±μ„ μ΄μ©ν•΄ λ‹¤μ΄λ΅λ“ λ°›μ€ λ°μ΄ν„°λ¥Ό μ΄μ©ν•΄ λ°±ν…μ¤λ¥Ό ν•΄λ„ λλ©°, λ³Έ μ¥μ—μ„λ” μ•μ„ λ‹¤μ΄λ΅λ“ λ°›μ€ κΈ€λ΅λ² μμ‚°μ„ λ€ν‘ν•λ” ETF λ°μ΄ν„°λ¥Ό μ‚¬μ©ν•κ² μµλ‹λ‹¤.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">prices</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/asset_data.csv&#39;</span><span class="p">,</span> <span class="n">index_col</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">prices</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">prices</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id3">
<h3>16.1.2 μ „λµμ μ •μ<a class="headerlink" href="#id3" title="Permalink to this headline">Β¶</a></h3>
<p>λ‘λ²μ§Έλ΅ μ‹λ®¬λ μ΄μ… ν•κ³ μ ν•λ” λ°±ν…μ¤νΈκ°€ μ–΄λ–¤ κ²ƒμΈμ§€λ¥Ό μ •μν•΄μ•Ό ν•©λ‹λ‹¤. 10κ° μμ‚°μ„ λ™μΌλΉ„μ¤‘μΌλ΅ ν¬μν•λ©°, λ§¤μ›” λ§ λ¦¬λ°Έλ°μ‹± ν•λ” μ „λµμ„ μ •μν•΄λ³΄λ„λ΅ ν•κ² μµλ‹λ‹¤. <code class="docutils literal notranslate"><span class="pre">Strategy()</span></code> ν•¨μ λ‚΄μ— algos λ¨λ“μ„ μ΄μ©ν•΄ λ°±ν…μ¤νΈ ν•κ³ μ ν•λ” λ‚΄μ©μ„ μ…λ ¥ν•©λ‹λ‹¤.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># μ „μ²΄ μμ‚° λ™μΌλΉ„μ¤‘, λ§¤μ›” λ§ λ¦¬λ°Έλ°μ‹±</span>
<span class="n">strategy</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">Strategy</span><span class="p">(</span><span class="s2">&quot;Asset_EW&quot;</span><span class="p">,</span>
                       <span class="p">[</span><span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">SelectAll</span><span class="p">(),</span>
                        <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">WeighEqually</span><span class="p">(),</span>
                        <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">RunMonthly</span><span class="p">(),</span>
                        <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">Rebalance</span><span class="p">()</span>
                       <span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<ol class="simple">
<li><p>λ¨Όμ € μ „λµμ μ΄λ¦„(Asset_EW)μ„ μ…λ ¥ν•©λ‹λ‹¤.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bt.algos.SelectAll()</span></code> ν•¨μλ¥Ό ν†µν•΄ λ¨λ“  λ°μ΄ν„°λ¥Ό μ‚¬μ©ν•¨μ„ μ •μν•©λ‹λ‹¤.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bt.algos.WeighEqually()</span></code> ν•¨μλ¥Ό ν†µν•΄ λ™μΌλΉ„μ¤‘μ„ μ •μν•©λ‹λ‹¤.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bt.algos.RunMonthly()</span></code> ν•¨μλ¥Ό ν†µν•΄ λ§¤μ›”λ§ λ¦¬λ°Έλ°μ‹± ν•¨μ„ μ •μν•©λ‹λ‹¤.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bt.algos.Rebalance()</span></code> ν•¨μλ¥Ό ν†µν•΄ κ³„μ‚°λ λΉ„μ¤‘μ— λ”°λΌ λ¦¬λ°Έλ°μ‹± ν•¨μ„ μ •μν•©λ‹λ‹¤.</p></li>
</ol>
<p>μ΄ μ™Έμ— algos λ¨λ“μ„ ν†µν•΄ λ‹¤μ–‘ν• λ°±ν…μ¤νΈ λ΅μ§μ„ μ •μν•  μ μμΌλ©°, μμ„Έν• λ‚΄μ©μ€ μ•„λ μ‚¬μ΄νΈμ—μ„ ν™•μΈν•  μ μμµλ‹λ‹¤.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">pmorissette</span><span class="o">.</span><span class="n">github</span><span class="o">.</span><span class="n">io</span><span class="o">/</span><span class="n">bt</span><span class="o">/</span><span class="n">bt</span><span class="o">.</span><span class="n">html</span><span class="c1">#module-bt.algos</span>
</pre></div>
</div>
</div>
<div class="section" id="id4">
<h3>16.1.3 μ „λµμ λ°±ν…μ¤νΈ<a class="headerlink" href="#id4" title="Permalink to this headline">Β¶</a></h3>
<p>μ•μ—μ„ μ •μλ λ‚΄μ©μ„ λ°”νƒ•μΌλ΅ λ°±ν…μ¤νΈλ¥Ό μ‹¤ν–‰ν•λ„λ΅ ν•κ² μµλ‹λ‹¤.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">prices</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="c1"># λ°±ν…μ¤νΈ μƒμ„±</span>
<span class="n">backtest</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">Backtest</span><span class="p">(</span><span class="n">strategy</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

<span class="c1"># λ°±ν…μ¤νΈ μ‹¤ν–‰</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">backtest</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ol class="simple">
<li><p>κ°€κ²© λ°μ΄ν„° μ¤‘ ETFμ μ‹μ‘ μ‹μ μ΄ λ¨λ‘ λ‹¤λ¥΄λ―€λ΅, <code class="docutils literal notranslate"><span class="pre">dropna()</span></code> ν•¨μλ¥Ό ν†µν•΄ NAλ¥Ό λ¨λ‘ μ κ±°ν•μ—¬ μ‹μ‘μ‹μ μ„ λ™μΌν•κ² λ§λ“­λ‹λ‹¤.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Backtest()</span></code> ν•¨μλ¥Ό ν†µν•΄ λ°±ν…μ¤νΈλ¥Ό μƒμ„±ν•  μ μμΌλ©°, μ•μ—μ„ μ •μν• λ°±ν…μ¤νΈ λ‚΄μ©λ κ°€κ²© λ°μ΄ν„°λ¥Ό μ…λ ¥ν•©λ‹λ‹¤.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">run()</span></code> ν•¨μλ¥Ό ν†µν•΄ λ°±ν…μ¤νΈλ¥Ό μ‹¤ν–‰ν•λ©°, μ•μ—μ„ μƒμ„±λ λ°±ν…μ¤νΈλ¥Ό μ…λ ¥ν•©λ‹λ‹¤.</p></li>
</ol>
</div>
</div>
<div class="section" id="id5">
<h2>16.1.4 κ²°κ³Όμ— λ€ν• ν‰κ°€<a class="headerlink" href="#id5" title="Permalink to this headline">Β¶</a></h2>
<p>μ„ κ³Όμ •μ„ ν†µν•΄ μ‹λ®¬λ μ΄μ… λ λ°±ν…μ¤νΈμ κ²°κ³Όλ¥Ό μ‚΄ν΄λ³΄λ„λ΅ ν•κ² μµλ‹λ‹¤.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result</span><span class="o">.</span><span class="n">prices</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Asset_EW</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2006-12-18</th>
      <td>100.000000</td>
    </tr>
    <tr>
      <th>2006-12-19</th>
      <td>100.000000</td>
    </tr>
    <tr>
      <th>2006-12-20</th>
      <td>100.208564</td>
    </tr>
    <tr>
      <th>2006-12-21</th>
      <td>100.077634</td>
    </tr>
    <tr>
      <th>2006-12-22</th>
      <td>100.038885</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
    </tr>
    <tr>
      <th>2021-04-12</th>
      <td>211.231709</td>
    </tr>
    <tr>
      <th>2021-04-13</th>
      <td>212.561644</td>
    </tr>
    <tr>
      <th>2021-04-14</th>
      <td>212.866016</td>
    </tr>
    <tr>
      <th>2021-04-15</th>
      <td>215.040685</td>
    </tr>
    <tr>
      <th>2021-04-16</th>
      <td>215.357183</td>
    </tr>
  </tbody>
</table>
<p>3606 rows Γ— 1 columns</p>
</div></div></div>
</div>
<p>λ°±ν…μ¤νΈ κ²°κ³Όμ—μ„ <code class="docutils literal notranslate"><span class="pre">price</span></code>λ¥Ό μ…λ ¥ν•λ©΄ λ„μ μμµλ¥ μ΄ λ°μ΄ν„°ν”„λ μ„ ν•νƒλ΅ λ‚νƒ€λ©°, μ‹μ‘μ‹μ μ„ 100μΌλ΅ ν™μ‚°ν•μ—¬ κ³„μ‚°λ©λ‹λ‹¤.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">to_returns</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Asset_EW</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2006-12-18</th>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2006-12-19</th>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>2006-12-20</th>
      <td>0.002086</td>
    </tr>
    <tr>
      <th>2006-12-21</th>
      <td>-0.001307</td>
    </tr>
    <tr>
      <th>2006-12-22</th>
      <td>-0.000387</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
    </tr>
    <tr>
      <th>2021-04-12</th>
      <td>-0.001979</td>
    </tr>
    <tr>
      <th>2021-04-13</th>
      <td>0.006296</td>
    </tr>
    <tr>
      <th>2021-04-14</th>
      <td>0.001432</td>
    </tr>
    <tr>
      <th>2021-04-15</th>
      <td>0.010216</td>
    </tr>
    <tr>
      <th>2021-04-16</th>
      <td>0.001472</td>
    </tr>
  </tbody>
</table>
<p>3606 rows Γ— 1 columns</p>
</div></div></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">prices</span></code>μ— μ¶”κ°€λ΅ <code class="docutils literal notranslate"><span class="pre">to_returns()</span></code>λ¥Ό μ…λ ¥ν•λ©΄, μμµλ¥ μ΄ κ³„μ‚°λ©λ‹λ‹¤.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="k">matplotlib</span> inline

<span class="n">result</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">legend</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/16_backtest_23_0.png" src="_images/16_backtest_23_0.png" />
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">plot()</span></code> ν•¨μλ¥Ό ν†µν•΄ λ„μ μμµλ¥ μ„ κ·Έλν”„λ΅ λ‚νƒ€λ‚Ό μλ„ μμµλ‹λ‹¤.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result</span><span class="o">.</span><span class="n">plot_weights</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/16_backtest_25_0.png" src="_images/16_backtest_25_0.png" />
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">plot_weights()</span></code> ν•¨μλ¥Ό ν†µν•΄ κ° μΆ…λ© λ³„ ν¬μ λΉ„μ¤‘μ„ κµ¬ν•  μλ„ μμµλ‹λ‹¤. κ·Έλ¬λ‚ λΉ„μ¤‘μ΄ κ²Ήμ³ μ λ³΄μ΄μ§€ μ•μΌλ―€λ΅, matplotlib ν¨ν‚¤μ§€λ¥Ό μ΄μ©ν•΄ κΎΈλ©°λ³΄λ„λ΅ ν•κ² μµλ‹λ‹¤.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">cm</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get_security_weights</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">area</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">ylim</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">legend</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">colormap</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">jet</span><span class="p">)</span>
<span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">handles</span><span class="p">),</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">labels</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.15</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/16_backtest_27_0.png" src="_images/16_backtest_27_0.png" />
</div>
</div>
<p>μΆ…λ©λ³„ ν¬μλΉ„μ¤‘μ€ <code class="docutils literal notranslate"><span class="pre">get_security_weights()</span></code> ν•¨μλ¥Ό ν†µν•΄ λ°μ΄ν„°ν”„λ μ„ ν•νƒλ΅ κµ¬ν•  μ μμΌλ©°, μ΄λ¥Ό κ·Έλ¦ΌμΌλ΅ λ‚νƒ€λ‚΄μ£Όλ„λ΅ ν•©λ‹λ‹¤. λ§¤μ›” λ§ λ¦¬λ°Έλ°μ‹±μ„ ν•λ―€λ΅, λ€λ¶€λ¶„μ κµ¬κ°„μ—μ„ λ¨λ“  μμ‚°μ— 10%μ”© κ· λ“±ν•κ² ν¬μλ©λ‹λ‹¤.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Asset_EW</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>start</th>
      <td>2006-12-18 00:00:00</td>
    </tr>
    <tr>
      <th>end</th>
      <td>2021-04-16 00:00:00</td>
    </tr>
    <tr>
      <th>rf</th>
      <td>0</td>
    </tr>
    <tr>
      <th>total_return</th>
      <td>1.15357</td>
    </tr>
    <tr>
      <th>cagr</th>
      <td>0.0550029</td>
    </tr>
    <tr>
      <th>max_drawdown</th>
      <td>-0.423533</td>
    </tr>
    <tr>
      <th>calmar</th>
      <td>0.129867</td>
    </tr>
    <tr>
      <th>mtd</th>
      <td>0.0372992</td>
    </tr>
    <tr>
      <th>three_month</th>
      <td>0.0430328</td>
    </tr>
    <tr>
      <th>six_month</th>
      <td>0.12863</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>λ§μ§€λ§‰μΌλ΅ <code class="docutils literal notranslate"><span class="pre">stats</span></code>λ¥Ό ν†µν•΄ κ°μΆ… μ„±κ³Ό μΈ΅μ •μΉλ¥Ό κµ¬ν•  μ μμµλ‹λ‹¤. μ„±κ³Ό ν‰κ°€μ— λ€ν•΄μ„λ” λ‹¤μ μ¥μ—μ„ λ”μ± μμ„Έν λ‹¤λ£¨λ„λ΅ ν•κ² μµλ‹λ‹¤.</p>
</div>
<div class="section" id="id6">
<h2>16.2 μ •μ  μμ‚°λ°°λ¶„: μ¬μ›¨λ” ν¬νΈν΄λ¦¬μ¤<a class="headerlink" href="#id6" title="Permalink to this headline">Β¶</a></h2>
<p>μμ‚°λ°°λ¶„μ€ ν¬νΈν΄λ¦¬μ¤ λ‚΄μ— λ‹¤μ–‘ν• μμ‚°μ— λ¶„μ‚° ν¬μν•μ—¬ μ„ν—μ„ μ¤„μ΄κ³  μΌμ •μμ¤€μ μμµλ¥  λ‹¬μ„±ν•κ³ μ ν•λ” λ°©λ²•μ…λ‹λ‹¤. μ΄λ¬ν• μμ‚° λ°°λ¶„μ€ ν¬κ² <strong>μ •μ  μμ‚°λ°°λ¶„</strong>κ³Ό <strong>λ™μ  μμ‚°λ°°λ¶„</strong>μΌλ΅ λ‚λ‰©λ‹λ‹¤.</p>
<p>μ •μ  μμ‚°λ°°λ¶„μ€ μ£Όμ‹κ³Ό μ±„κ¶ λΉ„μ¤‘ λ“± μμ‚°μ— λ€ν• λΉ„μ¤‘μ„ μ–΄λ– ν• μ‹μ¥ μƒν™©μ—μ„λ„ 6:4 νΉμ€ 8:2λ΅ λ°°λ¶„ν•κ³  μ μ§€ν•λ” μ „λµμ„ λ§ν•©λ‹λ‹¤. λ€ν‘μ μΈ μ •μ  μμ‚°λ°°λ¶„ μ „λµμ€ λ μ΄ λ‹¬λ¦¬μ¤κ°€ μ΄μ©ν•λ” κΈ°λ²•μΌλ΅ μ λ…ν•΄μ§„ μ¬μ›¨λ” ν¬νΈν΄λ¦¬μ¤κ°€ μμµλ‹λ‹¤. λ μ΄ λ‹¬λ¦¬μ¤λ” μ„Έκ³„ μµλ€ ν—¤μ§€ν€λ“μΈ λΈλ¦Ώμ§€μ›ν„°(Bridgewater Associate)μ μ„¤λ¦½μμ…λ‹λ‹¤. κ·Έλ” μ‹μ‹κ°κ° λ³€ν™”λ” κ²½μ  μƒν™©μ†μ—μ„ μ–΄λ–»κ² μμ‚°λ°°λ¶„μ„ ν•΄λ„ κ²¬λ”μ μλ” ν¬νΈν΄λ¦¬μ¤λ¥Ό κµ¬μƒν•μ€μΌλ©°, μ΄κ²ƒμ΄ μ¬μ›¨λ” ν¬νΈν΄λ¦¬μ¤ μ…λ‹λ‹¤. κ²½μ ν™κ²½μ€ ν¬κ² κ²½μ  μ„±μ¥λ¥ κ³Ό λ¬Όκ°€ μƒμΉλ¥ λ΅ λ‚λ μ μμΌλ©°, κ° κµ­λ©΄λ§λ‹¤ μ°μν• μ„±κ³Όλ¥Ό λ³΄μ΄λ” μμ‚°μ€ λ‹¤λ¦…λ‹λ‹¤.</p>
<div class="figure align-default" id="backtest-allweather">
<img alt="_images/backtest_allweather.png" src="_images/backtest_allweather.png" />
<p class="caption"><span class="caption-number">Fig. 76 </span><span class="caption-text">κ²½μ ν™κ²½μ κµ¬λ¶„</span><a class="headerlink" href="#backtest-allweather" title="Permalink to this image">Β¶</a></p>
</div>
<ol class="simple">
<li><p>κ²½μ  μ„±μ¥λ¥ μ΄ λ†’μ€ κµ¬κ°„μ—μ„λ” μ„ν— μμ‚°μ μ„±κ³Όκ°€ μ°μν•©λ‹λ‹¤.</p></li>
<li><p>κ²½μ  μ„±μ¥λ¥ μ΄ λ‚®μ€ κµ¬κ°„μ—μ„λ” μ°λ‰ μ±„κ¶μ μ„±κ³Όκ°€ μ°μν•©λ‹λ‹¤.</p></li>
<li><p>λ¬Όκ°€ μƒμΉλ¥ μ΄ λ†’μ€ κµ¬κ°„μ—μ„λ” μ›μμ¬λ‚ μ‹ ν¥κµ­ μ±„κ¶μ μ„±κ³Όκ°€ μ°μν•©λ‹λ‹¤.</p></li>
<li><p>λ¬Όκ°€ μƒμΉλ¥ μ΄ λ‚®μ€ κµ¬κ°„μ—μ„λ” μ£Όμ‹κ³Ό μ±„κ¶ λ¨λ‘ μ„±κ³Όκ°€ μ°μν•©λ‹λ‹¤.</p></li>
</ol>
<p>μ¬μ›¨λ” ν¬νΈν΄λ¦¬μ¤λ” λ„¤ κ°€μ§€ μƒν™© μ¤‘ ν•λ‚λ¥Ό μμΈ΅ν•κΈ° λ³΄λ‹¤λ”, κ°κ°μ μƒν™©μ— λ§λ” μμ‚°μ„ λ¨λ‘ ν¬νΈν΄λ¦¬μ¤μ— λ‹΄μ•„ λ―Έλ¦¬ λ€λΉ„ν•©λ‹λ‹¤. λν• κ° μƒν™©μ΄ μ¬ ν™•λ¥ μ΄ 25%μ”© κ°™λ‹¤κ³  κ°€μ •ν•  κ²½μ°, μμ‚°λ³„ ν¬μλΉ„μ¤‘μ€ <a class="reference internal" href="#backtest-aw"><span class="std std-numref">Fig. 77</span></a>μ™€ κ°™μµλ‹λ‹¤.</p>
<div class="figure align-default" id="backtest-aw">
<img alt="_images/backtest_aw.png" src="_images/backtest_aw.png" />
<p class="caption"><span class="caption-number">Fig. 77 </span><span class="caption-text">μ¬μ›¨λ” ν¬νΈν΄λ¦¬μ¤ ν¬μ λΉ„μ¤‘</span><a class="headerlink" href="#backtest-aw" title="Permalink to this image">Β¶</a></p>
</div>
<div class="section" id="id7">
<h3>16.2.1 μ¬μ›¨λ” ν¬νΈν΄λ¦¬μ¤ λ°±ν…μ¤νΈ<a class="headerlink" href="#id7" title="Permalink to this headline">Β¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">bt</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">prices</span><span class="p">[[</span><span class="s1">&#39;SPY&#39;</span><span class="p">,</span> <span class="s1">&#39;TLT&#39;</span><span class="p">,</span> <span class="s1">&#39;IEF&#39;</span><span class="p">,</span> <span class="s1">&#39;GLD&#39;</span><span class="p">,</span> <span class="s1">&#39;DBC&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="n">aw</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">Strategy</span><span class="p">(</span><span class="s1">&#39;All Weather&#39;</span><span class="p">,</span>
                    <span class="p">[</span><span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">SelectAll</span><span class="p">(),</span>
                     <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">WeighSpecified</span><span class="p">(</span><span class="n">SPY</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">TLT</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">,</span> <span class="n">IEF</span> <span class="o">=</span> <span class="mf">0.15</span><span class="p">,</span> <span class="n">GLD</span> <span class="o">=</span> <span class="mf">0.075</span><span class="p">,</span> <span class="n">DBC</span> <span class="o">=</span> <span class="mf">0.075</span><span class="p">),</span>
                     <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">RunQuarterly</span><span class="p">(),</span>
                     <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">Rebalance</span><span class="p">()])</span>
<span class="n">aw_backtest</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">Backtest</span><span class="p">(</span><span class="n">aw</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
<span class="n">aw_result</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">aw_backtest</span><span class="p">)</span>

<span class="n">aw_result</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;All Weather&#39;</span><span class="p">,</span> <span class="n">legend</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/16_backtest_35_0.png" src="_images/16_backtest_35_0.png" />
</div>
</div>
<ol class="simple">
<li><p>prices λ°μ΄ν„° μ¤‘ μ£Όμ‹, μ¥κΈ°μ±„, μ¤‘κΈ°μ±„, κΈ, μ›μμ¬μ— ν•΄λ‹Ήν•λ” μ—΄λ§ μ„ νƒν•©λ‹λ‹¤.</p></li>
<li><p>μ „λµμ„ μ •μν•΄μ£Όλ©°, <code class="docutils literal notranslate"><span class="pre">bt.algos.WeighSpecified()</span></code>μ— κ° μμ‚°λ³„ λΉ„μ¤‘μ„ μ§μ ‘ μ…λ ¥ν•©λ‹λ‹¤. λν• <code class="docutils literal notranslate"><span class="pre">bt.algos.RunQuarterly()</span></code>λ¥Ό ν†µν•΄ λ¶„κΈ°λ³„ λ¦¬λ°Έλ°μ‹±μ„ μ •μν•©λ‹λ‹¤.</p></li>
<li><p>λ°±ν…μ¤νΈλ¥Ό μƒμ„± λ° μ‹¤ν–‰ν•©λ‹λ‹¤.</p></li>
</ol>
<p>λ„μ  μμµλ¥ μ„ ν™•μΈν•΄λ³΄λ©΄ λ‹¤μ–‘ν• μμ‚°μ— λ¶„μ‚°λμ–΄ μκΈ°μ— μ¥κΈ°κ°„ λ™μ• κΎΈμ¤€ν μƒμΉν•λ” λ¨μµμ„ λ³΄μ…λ‹λ‹¤.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">cm</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">aw_result</span><span class="o">.</span><span class="n">get_security_weights</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">area</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">ylim</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">legend</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">colormap</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">jet</span><span class="p">)</span>
<span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">handles</span><span class="p">),</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">labels</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/16_backtest_37_0.png" src="_images/16_backtest_37_0.png" />
</div>
</div>
<p>λ¶„κΈ° λ³„λ΅ λ¦¬λ°Έλ°μ‹±μ΄ μ΄λ£¨μ–΄μ§μ— λ”°λΌ, κ° μμ‚°λ³„ ν¬μλΉ„μ¤‘μ΄ μΌμ •ν•κ² μ μ§€λ©λ‹λ‹¤.</p>
</div>
</div>
<div class="section" id="id8">
<h2>16.3 λ™μ  μμ‚°λ°°λ¶„<a class="headerlink" href="#id8" title="Permalink to this headline">Β¶</a></h2>
<p>μ •μ  μμ‚°λ°°λ¶„μ΄ μμ‚° λ³„ μΌμ • λΉ„μ¤‘μ„ μ μ§€ν•λ” μ „λµμ΄λΌλ©΄, λ™μ  μμ‚°λ°°λ¶„μ€ μ‹μ¥ μƒν™©μ— λ”°λΌ ν¬μν•λ” λ€μƒκ³Ό λΉ„μ¤‘μ„ κ³„μ†ν•΄μ„ λ³€κ²½ν•λ” μ „λµμ…λ‹λ‹¤. μ—¬λ¬ κ²½μ  μƒν™©μ—μ„ μƒλ€μ μΌλ΅ μ λ¦¬ν• μμ‚°μ€ μΆ‹μ€ μ„±κ³Όλ¥Ό λ³΄μΌ κ²ƒμ΄λ©°, κ²½μ  κµ­λ©΄μ€ μ¥κΈ°κ°„ μ§€μ†λλ” μ¶”μ„Έκ°€ μμΌλ―€λ΅ λ¨λ©ν…€μ΄ μλ” μμ‚°μ— ν¬μν•λ” κ²ƒμ΄ ν„λ…ν• λ°©λ²•μΌ μ μμµλ‹λ‹¤. λ¨λ©ν…€μ„ μ΄μ©ν• λ™μ  μμ‚°λ°°λ¶„ ν¬νΈν΄λ¦¬μ¤λ” λ‹¤μκ³Ό κ°™μ΄ κµ¬μ„±λ©λ‹λ‹¤.</p>
<ol class="simple">
<li><p>κΈ€λ΅λ² 10κ° μμ‚° μ¤‘ κ³Όκ±° 12κ°μ›” μμµλ¥ μ΄ λ†’μ€ 5κ° μμ‚°μ„ μ„ νƒν•©λ‹λ‹¤.</p></li>
<li><p>μ„ν—κ· ν• ν¬νΈν΄λ¦¬μ¤λ¥Ό κµ¬μ„±ν•©λ‹λ‹¤.</p></li>
<li><p>λ§¤μ›” λ§ λ¦¬λ°Έλ°μ‹±μ„ μ‹¤μ‹ν•©λ‹λ‹¤.</p></li>
</ol>
<p>10κ° μμ‚°μ—μ„ κ³Όκ±° μμµλ¥  κΈ°μ¤€ 5κ° μμ‚°λ§ μ„ νƒν•λ” μ΄μ λ” λ¨λ©ν…€ ν¨κ³Όλ¥Ό μ–»κΈ° μ„ν•΄μ„ μ…λ‹λ‹¤. <a class="reference internal" href="#mom-rank"><span class="std std-numref">Fig. 78</span></a>λ” κΈ€λ΅λ² 10κ° μμ‚°μ κ³Όκ±° 6κ°μ›” μμµλ¥ μ„ κΈ°μ¤€μΌλ΅ μμ„λ¥Ό λ§¤κΈ°κ³ , μ΄λ“¤μ λ‹¤μ μ›” μμµλ¥ μ΄ μƒμ„ 50%κ°€ λ  ν™•λ¥ μ„ κµ¬ν• κ°’μ…λ‹λ‹¤. μμµλ¥ μ΄ λ†’μ€ 1-5μ„ κΉμ§€μ μμ‚°μ€ λ‹¤μ μ›”μ—λ„ μμµλ¥ μ΄ λ†’μ„ ν™•λ¥ μ΄ 50%κ°€ λ„μ§€λ§, μμµλ¥ μ΄ λ‚®μ€ 6-10μ„ κΉμ§€μ μμ‚°μ€ λ‹¤μ μ›”μ— μμµλ¥ μ΄ λ†’μ„ ν™•λ¥ μ΄ 50%κ°€ λμ§€ μ•μµλ‹λ‹¤. λ”°λΌμ„ μμ‚°κµ° κ°„μ—λ„ λ¨λ©ν…€ ν¨κ³Όκ°€ μ΅΄μ¬ν•λ©°, μ΄λ¥Ό ν™μ©ν•κΈ° μ„ν•΄ 5κ° μμ‚°λ§μ„ μ„ νƒν•΄ ν¬μν•©λ‹λ‹¤.</p>
<div class="figure align-default" id="mom-rank">
<img alt="_images/mom_rank.png" src="_images/mom_rank.png" />
<p class="caption"><span class="caption-number">Fig. 78 </span><span class="caption-text">μμ‚°κµ° λ‚΄ λ¨λ©ν…€ ν¨κ³Ό</span><a class="headerlink" href="#mom-rank" title="Permalink to this image">Β¶</a></p>
</div>
<p>λν• μ„ν—κ· ν• ν¬νΈν΄λ¦¬μ¤λ¥Ό μ΄μ©ν•΄ λ³€λ™μ„±μ΄ μ§€λ‚μΉκ² ν° μμ‚°μ— μν•΄ ν¬νΈν΄λ¦¬μ¤μ μμµλ¥ μ΄ ν¬κ² μν–¥λ°›λ” μΌμ„ μ¤„μ΄κ³ , μµλ€ν• μ•μ •μ μΌλ΅ ν¬νΈν΄λ¦¬μ¤λ¥Ό κµ¬μ„±ν•©λ‹λ‹¤.</p>
<div class="section" id="id9">
<h3>16.3.1 λ™μ  μμ‚°λ°°λ¶„ λ°±ν…μ¤νΈΒ¶<a class="headerlink" href="#id9" title="Permalink to this headline">Β¶</a></h3>
<p>λ™μ  μμ‚°λ°°λ¶„μ λ΅μ§μ΄ λ‹¤μ† λ³µμ΅ν•΄ λ³΄μ΄μ§€λ§, bt ν¨ν‚¤μ§€μ— λ‚΄μ¥λ ν•¨μλ¥Ό μ΄μ©ν•  κ²½μ° μ—­μ‹λ‚ λ§¤μ° μ†μ‰½κ² λ°±ν…μ¤νΈ ν•  μ μμµλ‹λ‹¤.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">bt</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="k">matplotlib</span> inline

<span class="n">data</span> <span class="o">=</span> <span class="n">prices</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="n">gdaa</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">Strategy</span><span class="p">(</span><span class="s1">&#39;GDAA&#39;</span><span class="p">,</span> 
                   <span class="p">[</span><span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">SelectAll</span><span class="p">(),</span>
                    <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">SelectMomentum</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span><span class="n">lookback</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">years</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)),</span>
                    <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">RunMonthly</span><span class="p">(),</span>
                    <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">WeighERC</span><span class="p">(</span><span class="n">lookback</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">years</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)),</span>
                    <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">Rebalance</span><span class="p">()</span>
                   <span class="p">])</span>      

<span class="n">gdaa_backtest</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">Backtest</span><span class="p">(</span><span class="n">gdaa</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
<span class="n">gdaa_result</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">gdaa_backtest</span><span class="p">)</span>

<span class="n">gdaa_result</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Global Dynamic Asset Allocation&#39;</span><span class="p">,</span> <span class="n">legend</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/16_backtest_43_0.png" src="_images/16_backtest_43_0.png" />
</div>
</div>
<ol class="simple">
<li><p>prices λ°μ΄ν„°μ—μ„ NAλ¥Ό μ κ±°ν•©λ‹λ‹¤.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bt.Strategy()</span></code> λ‚΄μ— μ „λµμ„ μ •μν•΄μ¤λ‹λ‹¤.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">bt.algos.SelectAll()</span></code>: μ „μ²΄ λ°μ΄ν„°λ¥Ό μ„ νƒν•©λ‹λ‹¤.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bt.algos.SelectMomentum(n</span> <span class="pre">=</span> <span class="pre">5,lookback</span> <span class="pre">=</span> <span class="pre">pd.DateOffset(years</span> <span class="pre">=</span> <span class="pre">1))</span></code>: λ¨λ©ν…€ μƒμ„ μΆ…λ©μ„ μ„ νƒν•λ©° κ°μλ” 5κ°, λ¨λ©ν…€ κ΄€μΈ΅ κΈ°κ°„μ€ κ³Όκ±° 1λ…„μ„ ν•©λ‹λ‹¤.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bt.algos.RunMonthly()</span></code>: λ§¤μ›” λ¦¬λ°Έλ°μ‹±μ„ μ‹¤μ‹ν•©λ‹λ‹¤.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bt.algos.WeighERC(lookback</span> <span class="pre">=</span> <span class="pre">pd.DateOffset(years</span> <span class="pre">=</span> <span class="pre">1))</span></code>: ERC μ¦‰ μ„ν—κ· ν• ν¬νΈν΄λ¦¬μ¤λ¥Ό κµ¬μ„±ν•λ©°, λ¶„μ‚°-κ³µλ¶„μ‚° κ³„μ‚°μ„ μ„ν• μμµλ¥ μ€ κ³Όκ±° 1λ…„ λ°μ΄ν„°λ¥Ό μ΄μ©ν•©λ‹λ‹¤.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bt.algos.Rebalance()</span></code>: λ¦¬λ°Έλ°μ‹±μ„ μ •μν•©λ‹λ‹¤.</p></li>
</ul>
</li>
<li><p>λ°±ν…μ¤νΈλ¥Ό μƒμ„± λ° μ‹¤ν–‰ν•©λ‹λ‹¤.</p></li>
</ol>
<p>μ΄μ²λΌ algos λ¨λ“ λ‚΄μ κ°μΆ… ν•¨μλ¥Ό μ΄μ©ν•λ©΄ λ‹¤μ–‘ν• μ „λµμ„ μ†μ‰½κ² μ •μ λ° λ°±ν…μ¤νΈ ν•  μ μμµλ‹λ‹¤.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>κ·Έλν”„λ¥Ό μ‚΄ν΄λ³΄λ©΄ μ²μ 1λ…„κ°„μ€ μμµλ¥ μ— λ³€ν™”κ°€ μ—†μΌλ©°, μ΄λ” λ¨λ©ν…€ κ΄€μΈ΅μ„ μ„ν• 1λ…„ κ°„μ€ ν¬μλ¥Ό ν•  μ μ—†κΈ° λ•λ¬Έμ…λ‹λ‹¤. μ„±κ³Όλ¥Ό ν‰κ°€ν•  λ•λ” μ΄μ²λΌ ν¬μκ°€ μ΄λ£¨μ–΄μ§€μ§€ μ•λ” κΈ°κ°„μ„ μ μ™Έν•κ³  μ‹¤μ  ν¬μκ°€ μ΄λ£¨μ–΄μ§„ λ¶€λ¶„λ¶€ν„° ν‰κ°€ν•΄μ•Ό ν•©λ‹λ‹¤.</p>
</div>
</div>
<div class="section" id="id10">
<h3>16.3.2 κ±°λ λΉ„μ© κ³ λ ¤ν•κΈ°<a class="headerlink" href="#id10" title="Permalink to this headline">Β¶</a></h3>
<p>μ •μ  μμ‚°λ°°λ¶„κ³Όλ” λ‹¬λ¦¬ λ™μ  μμ‚°λ°°λ¶„μ€ λ§¤ μ‹μ λ§λ‹¤ ν¬μν•λ” λ€μƒ λ° ν¬μλΉ„μ¤‘μ΄ λ³€ν•©λ‹λ‹¤.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">cm</span>

<span class="n">wt</span> <span class="o">=</span> <span class="n">gdaa_result</span><span class="o">.</span><span class="n">get_security_weights</span><span class="p">()</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="n">prices</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">wt</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">area</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">ylim</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">legend</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">colormap</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">jet</span><span class="p">)</span>
<span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">handles</span><span class="p">),</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">labels</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.15</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/16_backtest_47_0.png" src="_images/16_backtest_47_0.png" />
</div>
</div>
<p>κΈ°μ΅΄ μ •μ  μμ‚°λ°°λ¶„λ³΄λ‹¤ ν¬μ λΉ„μ¤‘μ λ³€ν™”κ°€ μƒλ‹Ήν μ‹¬ν•κ²ƒμ„ ν™•μΈν•  μ μμµλ‹λ‹¤. μ΄λ” μμµλ¥  μƒμ„ 5κ°μ— ν•΄λ‹Ήν•λ” μμ‚°μ΄ λ§¤μ›” λ§ λ°”λ€λ©°, μ„ν—κ· ν• ν¬νΈν΄λ¦¬μ¤λ¥Ό κµ¬μ„±ν•λ” λΉ„μ¤‘μ΄ κ³„μ†ν•΄μ„ λ°”λ€κΈ° λ•λ¬Έμ…λ‹λ‹¤.</p>
<p>λ¨λΈ ν¬νΈν΄λ¦¬μ¤μ κ²½μ° μ΄λ¬ν• μ μ„ μ‹ κ²½μ“°μ§€ μ•μ•„λ„ λμ§€λ§, μ‹¤μ  ν¬μμ—μ„λ” μ¦μ€ ν„΄μ¤λ²„λ΅ μΈν• λ§¤λ§¤λΉ„μ©, μ„ΈκΈ, κΈ°νƒ€λΉ„μ© λ“±μ΄ λ§¤μ° μ¤‘μ”ν•΄μ§‘λ‹λ‹¤. ν•΄λ‹Ή μ „λµμ ν„΄μ¤λ²„λ¥Ό μ‚΄ν΄λ³΄λ„λ΅ ν•κ² μµλ‹λ‹¤.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gdaa_backtest</span><span class="o">.</span><span class="n">turnover</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">legend</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/16_backtest_49_0.png" src="_images/16_backtest_49_0.png" />
</div>
</div>
<p>μƒμ„±λ λ°±ν…μ¤νΈμ—μ„ <code class="docutils literal notranslate"><span class="pre">turnover</span></code>λ¥Ό ν†µν•΄ ν„΄μ¤λ²„λ¥Ό κµ¬ν•  μ μμµλ‹λ‹¤. λ§¤μ›” μƒλ‹Ήν• ν„΄μ¤λ²„κ°€ λ°μƒν•λ―€λ΅, μ΄λ¥Ό κ³ λ ¤ν• μμµλ¥ μ„ μ¶”κ°€λ΅ μ‚΄ν΄λ³Ό ν•„μ”κ°€ μμµλ‹λ‹¤. λ§¤μ νΉμ€ λ§¤λ„λ‹Ή λ°μƒν•λ” μ„ΈκΈ, μμλ£, μ‹μ¥μ¶©κ²© λ“± μ΄ λΉ„μ©μ„ 0.2%λ΅ κ°€μ •ν•μ—¬ λ°±ν…μ¤νΈλ¥Ό μ‹¤ν–‰ν•κ² μµλ‹λ‹¤.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gdaa_backtest_net</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">Backtest</span><span class="p">(</span><span class="n">gdaa</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;GDAA_net&#39;</span><span class="p">,</span> <span class="n">commissions</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">q</span><span class="p">,</span> <span class="n">p</span><span class="p">:</span> <span class="nb">abs</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="o">*</span> <span class="n">p</span> <span class="o">*</span> <span class="mf">0.002</span><span class="p">)</span>
<span class="n">gdaa_result</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">gdaa_backtest</span><span class="p">,</span> <span class="n">gdaa_backtest_net</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ol class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">bt.Backtest()</span></code> ν•¨μ λ‚΄μ— κΈ°μ΅΄μ— μ •μλ λ°±ν…μ¤νΈμΈ gdaaλ¥Ό κ·Έλ€λ΅ μ‚¬μ©ν•λ©°, μ΄λ¦„λ§ <strong>GDAA_net</strong>μΌλ΅ λ³€κ²½ν•©λ‹λ‹¤. λν• commissions λ¶€λ¶„μ— μμλ£λ¥Ό κ³„μ‚°ν•λ” λ¶€λ¶„μ„ μ…λ ¥ν•©λ‹λ‹¤. qλ” quantity(μ£Όμ), pλ” price(μ£Όκ°€)λ¥Ό μλ―Έν•λ©°, μ¦‰ μ΄ κ±°λ κ°€κ²©μ—μ„ 0.2%κ°€ μμλ£λ΅ λ‚κ°„λ‹¤κ³  κ°€μ •ν•©λ‹λ‹¤.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">bt.run()</span></code> λ‚΄μ— κΈ°μ΅΄μ— μƒμ„±λ λ°±ν…μ¤νΈ λ‚΄μ©(gdaa_backtest)κ³Ό μƒλ΅­κ² μƒμ„±λ λ°±ν…μ¤νΈ λ‚΄μ©(gdaa_backtest_net)μ„ λ™μ‹μ— μ…λ ¥ν•λ©΄, λ‘ κ°μ λ°±ν…μ¤νΈκ°€ ν•λ²μ— μ‹¤ν–‰λ©λ‹λ‹¤.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gdaa_result</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Global Dynamic Asset Allocation&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/16_backtest_53_0.png" src="_images/16_backtest_53_0.png" />
</div>
</div>
<p>κΈ°μ΅΄μ λΉ„μ©μ„ κ³ λ ¤ν•μ§€ μ•μ€ ν¬νΈν΄λ¦¬μ¤(GDAA)μ— λΉ„ν•΄, λΉ„μ©μ„ μ°¨κ°ν• ν¬νΈν΄λ¦¬μ¤(GDAA_net)μ μμµλ¥ μ΄ μ‹κ°„μ΄ μ§€λ‚¨μ— λ”°λΌ μ„μ„ν κ°μ†ν•©λ‹λ‹¤. μ΄λ¬ν• μ°¨μ΄λ” λΉ„μ©μ΄ ν¬κ±°λ‚ ν„΄μ¤λ²„κ°€ λ†’μ„μλ΅ λ”μ± λ²μ–΄μ§€κ² λ©λ‹λ‹¤</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>μ‹¤μ  μ „λ¬Έμ μΈ λ°±ν…μ¤νΈμ—μ„λ” λ§¤λ§¤λΉ„μ©μ„ μΌκ΄„μ μΌλ΅ μ μ©ν•κΈ° λ³΄λ‹¤λ”, κ° ETFλ³„ λ§¤μ-λ§¤λ„ μ¤ν”„λ λ“ λ“± λ”μ± ν„μ‹¤κ³Ό κ°€κΉμ΄ κ°’μ„ μ μ©ν•©λ‹λ‹¤.</p>
</div>
</div>
</div>
<div class="section" id="id11">
<h2>16.4 μ¶”μ„Έμ¶”μΆ… μ „λµ λ°±ν…μ¤νΈ<a class="headerlink" href="#id11" title="Permalink to this headline">Β¶</a></h2>
<p>μ¶”μ„Έμ¶”μΆ…μ΄λ€ μ£Όκ°€κ°€ λ™μΌν• λ°©ν–¥μΌλ΅ μ§€μ†λ  κ²ƒμ΄λΌλ”λ° λ² ν…ν•λ” κ²ƒμ…λ‹λ‹¤. μ¶”μ„Έμ¶”μΆ…, νΉμ€ λ¨λ©ν…€ μ „λµμ€ μ›”μ¤νΈλ¦¬νΈμ—μ„ κ°€μ¥ μ¤λλ ν¬μμ „λµ μ¤‘ ν•λ‚λ΅μ¨, λ¬΄λ ¤ 1838λ…„μ— μ¶κ°„λ μ±…μ—λ„ μ„¤λ…λ  λ§νΌ μ—­μ‚¬κ°€ κΈΈκ³ , ν„μ¬μ—λ„ κ°€μ¥ λ§μ΄ μ‚¬μ©λλ” μ „λµ μ¤‘ ν•λ‚μ…λ‹λ‹¤.</p>
<div class="section" id="id12">
<h3>16.4.1 λ§μΌ“ νƒ€μ΄λ° μ „λµ<a class="headerlink" href="#id12" title="Permalink to this headline">Β¶</a></h3>
<p>λ€ν‘μ μΈ μ¶”μ„Έμ¶”μΆ… μ „λµμΈ μ΄λ™ν‰κ· μ„ μ„ μ΄μ©ν• νΈλ μ΄λ”©μ λ°±ν…μ¤νΈλ¥Ό μ§„ν–‰ν•΄λ³΄λ„λ΅ ν•κ² μµλ‹λ‹¤. λ©”λΈ νλ²„(Meb Faber)λ” λ³ΈμΈμ λ…Όλ¬Έμ„ ν†µν•΄, μ‹μ  μ„ νƒ(Market Timing) μ „λµμ„ μ‚¬μ©ν•  κ²½μ° λ‹¨μν λ§¤μ ν›„ λ³΄μ ν•λ” κ²ƒ λ€λΉ„ κ·Ήμ‹¬ν• ν•λ½μ¥μ—μ„ λ‚™ν­μ„ μ¤„μΌ μ μμΌλ©°, μ΄λ΅ μΈν•΄ μ„ν— λ€λΉ„ μμµλ¥ μ„ μ¬λ¦΄ μ μλ‹¤κ³  μ„¤λ…ν•©λ‹λ‹¤. λ…Όλ¬Έμ—μ„ λ§ν•λ” μ‹μ  μ„ νƒμ ν¬μ κ·μΉ™μ€ λ‹¤μκ³Ό κ°™μµλ‹λ‹¤.</p>
<div class="math notranslate nohighlight">
\[ μ£Όκ°€ &gt; 10κ°μ›” μ΄λ™ν‰κ·  β†’ λ§¤μ\]</div>
<div class="math notranslate nohighlight">
\[ μ£Όκ°€ &lt; 10κ°μ›” μ΄λ™ν‰κ·  β†’ λ§¤λ„\ λ°\ ν„κΈλ³΄μ \]</div>
<p>μ¦‰ μ£Όκ°€κ°€ 10κ°μ›” μ΄λ™ν‰κ·  λ³΄λ‹¤ μ„μ— μλ‹¤λ” κ²ƒμ€ μƒμΉμ¶”μ„Έλ¥Ό μλ―Έν•λ―€λ΅ λ§¤μ ν¬μ§€μ…μ„, 10κ°μ›” μ΄λ™ν‰κ·  λ³΄λ‹¤ μ•„λμ— μλ‹¤λ” κ²ƒμ„ ν•λ½μ¶”μ„Έλ¥Ό μλ―Έν•λ―€λ΅ ν„κΈ λ³΄μ λ¥Ό ν†µν•΄ ν•λ½ λ°©μ–΄λ¥Ό ν•κ³ μ ν•©λ‹λ‹¤. λ¨Όμ € ν•΄λ‹Ή κ·μΉ™μ„ λ―Έκµ­ S&amp;P 500λ¥Ό μ¶”μΆ…ν•λ” SPY ETFμ— μ μ©ν•λ” μμ λ¥Ό μ‚΄ν΄λ³΄κ² μΌλ©°, λ¦¬λ°Έλ°μ‹±μ€ λ§¤μ›” μ‹¤ν–‰ν•©λ‹λ‹¤.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># SMA</span>
<span class="kn">import</span> <span class="nn">talib</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">prices</span><span class="p">[[</span><span class="s1">&#39;SPY&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">sma</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">talib</span><span class="o">.</span><span class="n">SMA</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">200</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>λ¨Όμ € <code class="docutils literal notranslate"><span class="pre">apply()</span></code> ν•¨μ λ‚΄λ¶€μ— <code class="docutils literal notranslate"><span class="pre">SMA()</span></code>μ„ μ΄μ©ν•΄ 200μΌ(10κ°μ›”) μ΄λ™ν‰κ· μ„ κµ¬ν•΄μ¤λ‹λ‹¤.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">bt</span>

<span class="n">bt_sma</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">Strategy</span><span class="p">(</span><span class="s1">&#39;Timing&#39;</span><span class="p">,</span> 
                     <span class="p">[</span><span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">SelectWhere</span><span class="p">(</span><span class="n">data</span> <span class="o">&gt;</span> <span class="n">sma</span><span class="p">),</span>
                      <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">RunMonthly</span><span class="p">(),</span>
                      <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">WeighEqually</span><span class="p">(),</span>
                      <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">Rebalance</span><span class="p">()])</span>
<span class="n">bt_sma_backtest</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">Backtest</span><span class="p">(</span><span class="n">bt_sma</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">bt.algos.SelectWhere()</span></code>λ” μ…λ ¥κ°’μ΄ True μΌλ•λ§ ν¬μλ¥Ό ν•λ„λ΅ μ •μν•©λ‹λ‹¤. μ¦‰, data(SPY)κ°€ sma(μ΄λ™ν‰κ· ) λ³΄λ‹¤ ν΄ λ•μ—λ§ ν¬μλ¥Ό ν•©λ‹λ‹¤. λ‚λ¨Έμ§€λ” μ„μ—μ„ μ‚΄ν΄λ³Έ κ²ƒλ“¤κ³Ό λ™μΌν•©λ‹λ‹¤.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">buy_and_hold</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
    
    <span class="c1"># Define the benchmark strategy</span>
    <span class="n">bt_strategy</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">Strategy</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> 
                              <span class="p">[</span><span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">RunOnce</span><span class="p">(),</span>
                               <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">SelectAll</span><span class="p">(),</span>
                               <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">WeighEqually</span><span class="p">(),</span>
                               <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">Rebalance</span><span class="p">()])</span>
    <span class="c1"># Return the backtest</span>
    <span class="k">return</span> <span class="n">bt</span><span class="o">.</span><span class="n">Backtest</span><span class="p">(</span><span class="n">bt_strategy</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>

<span class="c1"># Create benchmark strategy backtest</span>
<span class="n">stock</span> <span class="o">=</span> <span class="n">buy_and_hold</span><span class="p">(</span><span class="n">data</span><span class="p">[[</span><span class="s1">&#39;SPY&#39;</span><span class="p">]],</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;stock&#39;</span><span class="p">)</span>

<span class="n">bt_sma_result</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">bt_sma_backtest</span><span class="p">,</span> <span class="n">stock</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ol class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">buy_and_hold()</span></code> ν•¨μλ¥Ό ν†µν•΄ λ‹¨μ λ§¤μ ν›„ λ³΄μ μ κ²½μ°λ¥Ό μ •μν•©λ‹λ‹¤. <code class="docutils literal notranslate"><span class="pre">bt.algos.RunOnce()</span></code>λ” λ¦¬λ°Έλ°μ‹±μ΄ μ—†μ΄ μ²μ μƒνƒκ°€ κ·Έλ€λ΅ μ μ§€λλ” κ²ƒμ…λ‹λ‹¤.</p></li>
<li><p>SPYμ λ§¤μ ν›„ λ³΄μ  μ „λµμ„ μƒμ„±ν•©λ‹λ‹¤.</p></li>
<li><p>μ•μ—μ„ μƒμ„±λ μ¶”μ„Έμ¶”μΆ… μ „λµκ³Ό, λ§¤μ ν›„ λ³΄μ μ λ°±ν…μ¤νΈλ¥Ό μ‹¤ν–‰ν•©λ‹λ‹¤.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="k">matplotlib</span> inline

<span class="n">bt_sma_result</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="mi">200</span><span class="p">:]</span><span class="o">.</span><span class="n">rebase</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/16_backtest_65_0.png" src="_images/16_backtest_65_0.png" />
</div>
</div>
<p>μ¶”μ„Έμ¶”μΆ… μ „λµμ κ²½μ° μ΄λ™ν‰κ·  κ³„μ‚°μ„ μ„ν•΄ μ²μ 200 μΌκ°„μ€ ν¬μκ°€ λμ§€ μ•μΌλ―€λ΅ λ§¤μ ν›„ λ³΄μ  μ „λµκ³Ό μ‹μ‘ μ‹μ μ΄ μΌμΉν•μ§€ μ•μµλ‹λ‹¤. λ”°λΌμ„ λ‘ μ „λµ λ¨λ‘ 200λ²μ§Έ λ‚ λ¶€ν„°λ¥Ό μ‹μ‘μ‹μ μΌλ΅ μ‚Όμ•„μ•Ό ν•λ©°, <code class="docutils literal notranslate"><span class="pre">rebase()</span></code> ν•¨μλ¥Ό μ΄μ©ν•μ—¬ μ„ νƒλ λ°μ΄ν„°μ μ‹μ‘μ‹μ μ„ λ‹¤μ‹ 100μΌλ΅ λ§λ“¤μ–΄μ¤λ‹λ‹¤.</p>
<p>μ¶”μ„Έμ¶”μΆ… μ „λµμ„ μ‚¬μ©ν•  κ²½μ° 2000λ…„ IT λ²„λΈ”μ΄λ‚ 2008λ…„ κΈμµμ„κΈ°, 2020λ…„ μ½”λ΅λ‚ μ‚¬νƒμ—μ„ ν•λ½ν­μ΄ μ ν•λ©λ‹λ‹¤. μ¦‰ ν•λ½μ¶”μ„Έκ°€ μ‹μ‘λλ©΄ μ£Όμ‹μ„ λ¨λ‘ λ§¤λ„ν•μ—¬, μ¶”κ°€μ μΈ ν•λ½μ„ λ°©μ–΄ν•©λ‹λ‹¤.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bt_sma_result</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="mi">200</span><span class="p">:]</span><span class="o">.</span><span class="n">rebase</span><span class="p">()</span><span class="o">.</span><span class="n">to_drawdown_series</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/16_backtest_67_0.png" src="_images/16_backtest_67_0.png" />
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">to_drawdown_series()</span></code> ν•¨μλ” λ‚™ν­(drawdown)μ„ κ³„μ‚°ν•΄ μ¤λ‹λ‹¤. μ¶”μ„Έμ¶”μΆ… μ „λµμ„ μ‚¬μ©ν•  κ²½μ° ν•λ½ λ°©μ–΄κ°€ μ°μν•¨μ΄ ν™•μΈλ©λ‹λ‹¤.</p>
</div>
<div class="section" id="id13">
<h3>16.4.2 νλΌλ―Έν„° μµμ ν™”<a class="headerlink" href="#id13" title="Permalink to this headline">Β¶</a></h3>
<p>κ·Έλ ‡λ‹¤λ©΄ κ³Όμ—° 200μΌ(10κ°μ›”) μ΄λ™ν‰κ· μ„ μ‚¬μ©ν•λ” κ²ƒμ΄ μµμ μΌκΉμ”? νΉμ€ λ‹¤λ¥Έ κ°’μ„ μ‚¬μ©ν–μ„ λ• μμµλ¥ μ΄ λ” μΆ‹μ„μ μμ§€ μ•μ„κΉμ”?</p>
<p>200μΌκ³Ό κ°™μ΄ λ³€μλ¥Ό νλΌλ―Έν„°(parameter)λΌ ν•λ©°, μ„±κ³Όκ°€ μµλ€ν™” λλ” νλΌλ―Έν„°λ¥Ό μ°Ύλ” κ²ƒμ„ νλΌλ―Έν„° μµμ ν™”λΌκ³  ν•©λ‹λ‹¤. νΈλ μ΄λ”©μ—μ„ μ΄λ¬ν• νλΌλ―Έν„° μµμ ν™”λ” λ§¤μ° μ¤‘μ”ν• μ‘μ—…μ…λ‹λ‹¤. μ•μ„  λ§μΌ“ νƒ€μ΄λ° μ „λµμ—μ„ μ΄λ™ν‰κ· μ„ κ³„μ‚°ν•  λ• μ‚¬μ©ν•λ” μΌμλ¥Ό λ³€κ²½ν•΄κ°€λ©° μμµλ¥ μ„ ν™•μΈν•΄λ³΄λ„λ΅ ν•κ² μµλ‹λ‹¤.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># SMA</span>
<span class="kn">import</span> <span class="nn">talib</span>
<span class="kn">import</span> <span class="nn">bt</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">prices</span><span class="p">[[</span><span class="s1">&#39;SPY&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">timing</span><span class="p">(</span><span class="n">price</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    
    <span class="n">sma</span> <span class="o">=</span> <span class="n">price</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">talib</span><span class="o">.</span><span class="n">SMA</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
    <span class="n">stragety</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">Strategy</span><span class="p">(</span><span class="n">n</span><span class="p">,</span>
                           <span class="p">[</span><span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">SelectWhere</span><span class="p">(</span><span class="n">price</span> <span class="o">&gt;</span> <span class="n">sma</span><span class="p">),</span>
                            <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">RunMonthly</span><span class="p">(),</span>
                            <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">WeighEqually</span><span class="p">(),</span>
                            <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">Rebalance</span><span class="p">()])</span>
    
    <span class="n">backtest</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">Backtest</span><span class="p">(</span><span class="n">stragety</span><span class="p">,</span> <span class="n">price</span><span class="p">)</span>  
    
    <span class="k">return</span><span class="p">(</span><span class="n">backtest</span><span class="p">)</span>

<span class="n">n_20</span> <span class="o">=</span> <span class="n">timing</span><span class="p">(</span><span class="n">prices</span><span class="p">[[</span><span class="s1">&#39;SPY&#39;</span><span class="p">]],</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">n_60</span> <span class="o">=</span> <span class="n">timing</span><span class="p">(</span><span class="n">prices</span><span class="p">[[</span><span class="s1">&#39;SPY&#39;</span><span class="p">]],</span> <span class="mi">60</span><span class="p">)</span>
<span class="n">n_100</span> <span class="o">=</span> <span class="n">timing</span><span class="p">(</span><span class="n">prices</span><span class="p">[[</span><span class="s1">&#39;SPY&#39;</span><span class="p">]],</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">n_120</span> <span class="o">=</span> <span class="n">timing</span><span class="p">(</span><span class="n">prices</span><span class="p">[[</span><span class="s1">&#39;SPY&#39;</span><span class="p">]],</span> <span class="mi">120</span><span class="p">)</span>
<span class="n">n_150</span> <span class="o">=</span> <span class="n">timing</span><span class="p">(</span><span class="n">prices</span><span class="p">[[</span><span class="s1">&#39;SPY&#39;</span><span class="p">]],</span> <span class="mi">150</span><span class="p">)</span>
<span class="n">n_200</span> <span class="o">=</span> <span class="n">timing</span><span class="p">(</span><span class="n">prices</span><span class="p">[[</span><span class="s1">&#39;SPY&#39;</span><span class="p">]],</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">n_230</span> <span class="o">=</span> <span class="n">timing</span><span class="p">(</span><span class="n">prices</span><span class="p">[[</span><span class="s1">&#39;SPY&#39;</span><span class="p">]],</span> <span class="mi">230</span><span class="p">)</span>
<span class="n">n_250</span> <span class="o">=</span> <span class="n">timing</span><span class="p">(</span><span class="n">prices</span><span class="p">[[</span><span class="s1">&#39;SPY&#39;</span><span class="p">]],</span> <span class="mi">250</span><span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">n_20</span><span class="p">,</span> <span class="n">n_60</span><span class="p">,</span> <span class="n">n_100</span><span class="p">,</span> <span class="n">n_120</span><span class="p">,</span> <span class="n">n_150</span><span class="p">,</span> <span class="n">n_200</span><span class="p">,</span> <span class="n">n_230</span><span class="p">,</span> <span class="n">n_250</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ol class="simple">
<li><p>μ΄λ™ν‰κ· μ„ κ³„μ‚°ν• ν›„, λ°±ν…μ¤νΈλ¥Ό μƒμ„±ν•λ” λ¶€λ¶„μ„ <code class="docutils literal notranslate"><span class="pre">timing()</span></code> ν•¨μλ΅ μ‘μ„±ν•©λ‹λ‹¤.</p></li>
<li><p>20μΌλ¶€ν„° 250μΌκΉμ§€ μ΄λ™ν‰κ· μ„ μ΄μ©ν• λ§μΌ“νƒ€μ΄λ° λ¨λΈμ λ°±ν…μ¤νΈλ¥Ό μƒμ„±ν•©λ‹λ‹¤.</p></li>
<li><p>λ¨λ“  λ°±ν…μ¤νΈλ¥Ό ν•λ²μ— μ‹¤ν–‰ν•©λ‹λ‹¤.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">cm</span>

<span class="n">result</span><span class="o">.</span><span class="n">prices</span><span class="p">[</span><span class="mi">250</span><span class="p">:]</span><span class="o">.</span><span class="n">rebase</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">colormap</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">jet</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/16_backtest_73_0.png" src="_images/16_backtest_73_0.png" />
</div>
</div>
<p>λ„μ μμµλ¥ μ„ ν™•μΈν•΄λ³΄λ©΄ λ‹¨κΈ° λ³΄λ‹¤λ” μ¥κΈ° μ΄λ™ν‰κ· μ„ μ‚¬μ©ν•  μλ΅ μ°μν• μ„±κ³Όλ¥Ό κΈ°λ΅ν•©λ‹λ‹¤. κ·Έλ¬λ‚ μλ¥Όλ“¤μ–΄ 230μΌ μ΄λ™ν‰κ· μ΄ μµκ³ μ μμµλ¥ μ„ κΈ°λ΅ν•λ‹¤κ³  μ΄κ²ƒμ΄ μµμ μ νλΌλ―Έν„°λΌκ³  λ§ν•κΈ°λ” νλ“­λ‹λ‹¤. μ¥κΈ° μ΄λ™ν‰κ· μ„ μ‚¬μ©ν•λ” κ²ƒμ΄ λ‹¨κΈ° μ΄λ™ν‰κ· μ„ μ‚¬μ©ν•λ” κ²ƒλ³΄λ‹¤ μ„±κ³Όκ°€ μΆ‹μ€ μ΄μ λ”, μ¥κΈ° μ΄λ™ν‰κ· μ΄ μ¥κΈ°μ μΈ μ¶”μ„Έλ¥Ό λ” μμν•κΈ° λ•λ¬ΈμΌ μ μμµλ‹λ‹¤. κ·Έλ¬λ‚ κ°™μ€ μ¥κΈ° μ΄λ™ν‰κ· μ—μ„λ„ μλ¥Όλ“¤μ–΄ 230μΌμ΄ 210μΌ λ³΄λ‹¤ μ°μν• κ²ƒμ€ λ‹¨μν μ°μ—°μ κ²°κ³ΌμΌ μ μμΌλ©°, λ°±ν…μ¤νΈ κΈ°κ°„μ„ λ‹¤λ¥΄κ² ν•λ©΄ μ „ν€ λ‹¤λ¥Έ κ²°κ³Όκ°€ λ‚νƒ€λ‚  μλ„ μμµλ‹λ‹¤.</p>
<p>λ°±ν…μ¤νΈ κΈ°κ°„μ—μ„ μµμ ν™”λ νλΌλ―Έν„°κ°€ ν–¥ν›„μ—λ„ μµκ³ μ μμµλ¥ μ„ κΈ°λ΅ν•  κ²ƒμ΄λΌλ” μƒκ°μ€ μ„ν—ν•  μ μμµλ‹λ‹¤. λ°±ν…μ¤νΈμ—μ„λ” μ—„μ²­λ‚κ² μ°μν• μ„±κ³Όλ¥Ό λ³΄μ€λ μ „λµμ„ μ°Ύμ•„ μ©κΈ°μκ² μ‹¤μ  ν¬μμ— λ‚μ„°λ‹¤κ°€ κ³Όμµμ ν™”μ μ €μ£Όμ— λΉ μ Έ μ‹¤λ§μ¤λ¬μ΄ μμµλ¥ λ΅ μ΄μ–΄μ§€λ” κ²½μ°λ„ μΆ…μΆ… λ©κ²Όν–μµλ‹λ‹¤. λ”°λΌμ„ λ¨λΈμ— μ‚¬μ©λλ” νλΌλ―Έν„°μ κ°―μλ” μµλ€ν• μ‘κ², κ·Έλ¦¬κ³  μΈμƒν”(in-sample) λΏλ§ μ•„λ‹λΌ μ•„μ›ƒμ¤λΈμƒν”(out-of-sample) ν…μ¤νΈμ—μ„λ„ λ›°μ–΄λ‚ μ„±κ³Όλ¥Ό λ³΄μ΄λ” νλΌλ―Έν„°λ¥Ό νƒν•΄μ•Ό ν•κ² μµλ‹λ‹¤.</p>
</div>
<div class="section" id="id14">
<h3>16.4.3 λ΅±μ μ „λµ<a class="headerlink" href="#id14" title="Permalink to this headline">Β¶</a></h3>
<p>μ§€κΈκΉμ§€λ” μ£Όκ°€κ°€ μ΄λ™ν‰κ· μ„  μ„μ— μμ„ λ• λ§¤μν•λ©° κ·Έλ ‡μ§€ μ•μΌλ©΄ λ§¤λ„ν•λ” β€λ΅±μ¨λ¦¬β€™ μ „λµμ— λ€ν• λ°±ν…μ¤νΈλ¥Ό μ‹¤μ‹ν–μµλ‹λ‹¤. κ·Έλ¬λ‚ μ¶”μ„Έμ¶”μΆ… μ „λµμ€ μƒμΉμ¶”μ„Έμ— λ€ν• λ² ν…λΏλ§ μ•„λ‹λΌ κ³µλ§¤λ„, μΈλ²„μ¤ ETF νΉμ€ μ„ λ¬Όλ§¤λ„ ν¬μ§€μ…μ„ ν†µν•΄ ν•λ½μ¶”μ„Έμ—λ„ λ² ν…ν•  μ μμµλ‹λ‹¤.</p>
<p>ν”ν λ‹¨κΈ° μ΄λ™ν‰κ· μ„ μ΄ μ¤‘μ¥κΈ° μ΄λ™ν‰κ· μ„ μ„ λ«κ³  μ¬λΌκ°€λ” κ³¨λ“ ν¬λ΅μ¤μ κ²½μ° μƒμΉμ¶”μ„Έμ— λ€ν• μ‹ νΈλ¥Ό, λ°λ€λ΅ λ«κ³  λ‚΄λ ¤κ°€λ” λ°λ“ν¬λ΅μ¤μ κ²½μ° ν•λ½μ¶”μ„Έμ— λ€ν• μ‹ νΈλ¥Ό λ‚νƒ€λƒ…λ‹λ‹¤. κ³Όμ—° μ΄λ¬ν• μ‹ νΈλ¥Ό μ΄μ©ν•΄ νΈλ μ΄λ”© ν–μ„ λ• μ„±κ³Όκ°€ μ–΄λ–¤μ§€ μ‚΄ν΄λ³΄λ„λ΅ ν•κ² μµλ‹λ‹¤.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">talib</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">prices</span><span class="p">[[</span><span class="s1">&#39;SPY&#39;</span><span class="p">]]</span>
<span class="n">EMA_200</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">talib</span><span class="o">.</span><span class="n">EMA</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">200</span><span class="p">))</span>
<span class="n">EMA_60</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">talib</span><span class="o">.</span><span class="n">EMA</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">60</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>λ¨Όμ € μ¥κΈ°μ¶”μ„Έμ— ν•΄λ‹Ήν•λ” 200μΌ μ§€μ μ΄λ™ν‰κ· κ³Ό λ‹¨κΈ°μ¶”μ„Έμ— ν•΄λ‹Ήν•λ” 60μΌ μ§€μ μ΄λ™ν‰κ· μ„ κµ¬ν•©λ‹λ‹¤.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">signal</span> <span class="o">=</span> <span class="n">EMA_200</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">signal</span><span class="p">[</span><span class="n">EMA_60</span> <span class="o">&gt;=</span> <span class="n">EMA_200</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">signal</span><span class="p">[</span><span class="n">EMA_60</span> <span class="o">&lt;</span> <span class="n">EMA_200</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">signal</span><span class="p">[</span><span class="n">signal</span><span class="o">.</span><span class="n">isnull</span><span class="p">()]</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
</div>
<p>λ§μΌ 60μΌ μ΄λ™ν‰κ· μ΄ 200μΌ μ΄λ™ν‰κ· λ³΄λ‹¤ μ„μ— μμ„ κ²½μ°(κ³¨λ“ ν¬λ΅μ¤) 100% ν¬μ μ¦‰ λ§¤μλ¥Ό ν•λ©°, λ°λ€μ κ²½μ°(λ°λ“ν¬λ΅μ¤) -100% ν¬μ μ¦‰ λ§¤λ„λ¥Ό ν•©λ‹λ‹¤. μ΄λ™ν‰κ· μ„ κ³„μ‚°ν•κΈ° μ„ν• μ²μ 200μΌ λ¶€λ¶„μ€ λ°μ΄ν„°κ°€ μ—†μΌλ―€λ΅ ν¬μ§€μ…μ„ 0μΌλ΅ λ‘΅λ‹λ‹¤.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="k">matplotlib</span> inline

<span class="n">bind</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">data</span><span class="p">,</span> <span class="n">EMA_200</span><span class="p">,</span> <span class="n">EMA_60</span><span class="p">,</span> <span class="n">signal</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">bind</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;SPY&#39;</span><span class="p">,</span> <span class="s1">&#39;EMA 200&#39;</span><span class="p">,</span> <span class="s1">&#39;EMA 60&#39;</span><span class="p">,</span> <span class="s1">&#39;signal&#39;</span><span class="p">]</span>

<span class="n">bind</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">600</span><span class="p">:</span> <span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">secondary_y</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;signal&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/16_backtest_81_0.png" src="_images/16_backtest_81_0.png" />
</div>
</div>
<p>μ£Όκ°€μ™€ κ° μ΄λ™ν‰κ· μ„ , μ‹ νΈλ¥Ό κ·Έλ¦ΌμΌλ΅ λ‚νƒ€λ‚΄λ³΄λ©΄, λ‹¨κΈ° μ΄λ™ν‰κ· μ„ μ΄ μ¥κΈ° μ΄λ™ν‰κ· μ„  μ„μ— μμ„ κ²½μ°μ—λ” λ§¤μ, κ·Έλ ‡μ§€ μ•μ„ λ•λ” λ§¤λ„λ¥Ό ν•λ” κ²ƒμ΄ ν™•μΈλ©λ‹λ‹¤. μ΄μ  ν•΄λ‹Ή μ „λµμ λ°±ν…μ¤νΈλ¥Ό μ‹¤μ‹ν•΄λ³΄κ² μµλ‹λ‹¤.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">bt</span>

<span class="n">strategy</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">Strategy</span><span class="p">(</span><span class="s1">&#39;EMA_crossover&#39;</span><span class="p">,</span> 
                       <span class="p">[</span><span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">WeighTarget</span><span class="p">(</span><span class="n">signal</span><span class="p">),</span>
                        <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">Rebalance</span><span class="p">()])</span>
<span class="n">backtest</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">Backtest</span><span class="p">(</span><span class="n">strategy</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">backtest</span><span class="p">)</span>

<span class="n">result</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/16_backtest_83_0.png" src="_images/16_backtest_83_0.png" />
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">bt.algos.WeighTarget()</span></code> ν•¨μ λ‚΄μ— κ° μ‹μ λ³„ λΉ„μ¤‘μ„ μ…λ ¥ν•λ©΄, ν•΄λ‹Ή μ‹μ κ³Ό λΉ„μ¤‘μ— λ§μ¶° λ¦¬λ°Έλ°μ‹±μ΄ μ‹¤μ‹λ©λ‹λ‹¤. μ΄λ¥Ό ν†µν•΄ ν•΄λ‹Ή ν¨ν‚¤μ§€μ—μ„ ν•¨μ ν•νƒλ΅ μ κ³µν•μ§€ μ•λ” λ§¤μ° λ³µμ΅ν• μ „λµμ λ°±ν…μ¤νΈλ„ μ–Όλ§λ“ μ§€ μ‹¤ν–‰ν•  μ μμµλ‹λ‹¤.</p>
<p>κ²°κ³Όλ¥Ό μ‚΄ν΄λ³΄λ©΄ μ¥κΈ°κ°„ λ™μ• μ°μƒν–¥μ„ ν•λ‹¤κ°€ 2020λ…„ μ—„μ²­λ‚ λ‚™ν­μΌλ΅ λ€λ¶€λ¶„μ μμµμ„ λ°λ‚©ν–μµλ‹λ‹¤. μ™ μ΄λ° κ²°κ³Όκ°€ λ‚μ™”λ”μ§€ ν•΄λ‹Ή κµ¬κ°„μ„ μμ„Έν μ‚΄ν΄λ³΄λ„λ΅ ν•κ² μµλ‹λ‹¤.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">bind</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">prices</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)[</span><span class="s1">&#39;2020-01&#39;</span><span class="p">:</span><span class="s1">&#39;2020-09&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">secondary_y</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;signal&#39;</span><span class="p">],</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.7</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/16_backtest_85_0.png" src="_images/16_backtest_85_0.png" />
</div>
</div>
<p>μ½”λ΅λ‚ μ‚¬νƒλ΅ μΈν•΄ 2020λ…„ 3μ›”λ¶€ν„° λ―Έκµ­ μ£Όμ‹μ€ κΈ‰κ²©ν•κ² ν•λ½ν•κΈ° μ‹μ‘ν–μΌλ©°, 3μ›” μ¤‘μμ—λ” 60μΌ μ΄λ™ν‰κ· μ„ μ΄ 200μΌ μ΄λ™ν‰κ· μ„ μ„ ν•νν•¨μ— λ”°λΌ μ μ‹ νΈκ°€ λ°μƒν•μ€μµλ‹λ‹¤. κ·Έλ¬λ‚ κ³µκµλ΅­κ²λ„ ν•΄λ‹Ή μ‹μ λ¶€ν„° μ‹μ¥μ€ λ°”λ‹¥μ„ λ‹¤μ§€κ³  μ—„μ²­λ‚ μƒμΉμ„ λ³΄μ€μΌλ©°, μ „λµμ—μ„λ” μν¬μ§€μ…μ„ μ·¨ν•κ³  μλ” λ§νΌ μ†μ‹¤μ΄ λ°μƒν•κΈ° μ‹μ‘ν•©λ‹λ‹¤. 6μ›”μ΄ λμ„μ•Ό λ‹¤μ‹ κ³¨λ“ ν¬λ΅μ¤κ°€ λ°μƒν•μ—¬ λ΅± ν¬μ§€μ…μΌλ΅ μ „ν™ν•μ€μ§€λ§, λ¶κ³Ό 3λ‹¬λ™μ• λ³µκµ¬ν•  μ μ—†μ„ μ •λ„μ μ†μ‹¤μ„ μ…κ² λ©λ‹λ‹¤.</p>
<p>μ‹¤μ λ΅ μ¶”μ„Έμ¶”μΆ… μ „λµμ„ μ‚¬μ©ν•λ” λ§μ€ ν€λ“λ“¤μ΄ μ‹¤μ λ΅ 2020λ…„ 3μ›”λ¶€ν„° 6μ›”κΉμ§€ λ§‰λ€ν• μ†μ‹¤μ„ μ…μ—μµλ‹λ‹¤. 2020λ…„ μ΄λ°μ—λ” λ΅± ν¬μ§€μ…μ—μ„ μ†μ‹¤μ„ μ…κ³ , 3μ›”λ¶€ν„°λ” μν¬μ§€μ…μ—μ„ μ†μ‹¤μ„ μ…μ–΄ μ–‘λ°©ν–¥μ—μ„ λ¨λ‘ μ†μ‹¤μ„ μ…μ€ κ²ƒμ…λ‹λ‹¤.</p>
<p>λ§μΌ λ΅±μ¨λ¦¬ μ „λµμ„ νƒν–λ‹¤λ©΄ 3μ›”λ¶€ν„° 6μ›”κΉμ§€ λ‹¨μν μμµμ„ μ–»μ§€ λ»ν•κ²ƒμ— κ·Έμ³¤κ² μ§€λ§, μ ν¬μ§€μ…μΌλ΅ μΈν•΄ μ†μ‹¤μ΄ λ°°κ°€ λ κ²ƒμ…λ‹λ‹¤. μ΄μ²λΌ μ λ² ν…μ€ ν•λ½ μ‹μ¥μ—μ„λ„ λμ„ λ² μ μκ² ν•΄μ£Όμ§€λ§, μμƒμΉ λ»ν• κΈ‰λ°λ“±μ΄ λ‚μ¬ κ²½μ° μ†μ‹¤μ„ μ…νλ” μ–‘λ‚ μ κ²€μ΄ λκΈ°λ„ ν•©λ‹λ‹¤. μ΄λ¥Ό λ°©μ§€ν•κΈ° μ„ν•΄ νΈλ μ΄λ”©μ—μ„λ” λ‹¤μ–‘ν• μ‹ νΈμ κ²°ν•©, μ†μ‹¤μ ν•(μ¤νƒ‘λ΅μ¤, λ΅μ¤μ»·) λ“±μ„ μ¶”κ°€ν•κΈ°λ„ ν•©λ‹λ‹¤.</p>
</div>
</div>
<div class="section" id="id15">
<h2>16.5 ν‰κ· νκ·€ μ „λµ λ°±ν…μ¤νΈ<a class="headerlink" href="#id15" title="Permalink to this headline">Β¶</a></h2>
<p>μ¶”μ„Έμ¶”μΆ… μ „λµμ€ μ£Όκ°€κ°€ λ™μΌν• λ°©ν–¥μΌλ΅ μ§€μ†λλ‹¤κ³  λ³΄λ” λ°λ©΄, ν‰κ· νκ·€ μ „λµμ€ μ£Όκ°€κ°€ ν‰κ· μΌλ΅ νκ·€ν•λ‹¤κ³  λ³΄λ©΄ μ΄μ— λ² ν…ν•©λ‹λ‹¤. μ£Όκ°€κ°€ λ¬΄ν•μ • ν•λ°©ν–¥μΌλ΅ μ§€μ†λ  μλ” μ—†κΈ°μ— μ¶”μ„Έμ¶”μΆ… μ „λµκ³Ό ν‰κ· νκ·€ μ „λµμ„ μ μ΅°ν•©ν•  ν•„μ”κ°€ μμµλ‹λ‹¤.</p>
<div class="section" id="rsi">
<h3>16.5.1 RSIλ¥Ό μ΄μ©ν• μ „λµ<a class="headerlink" href="#rsi" title="Permalink to this headline">Β¶</a></h3>
<p>RSIλ” μΌμ •κΈ°κ°„ λ™μ• μ£Όκ°€μ μƒμΉν­κ³Ό ν•λ½ν­μ ν¬κΈ°λ¥Ό λΉ„κµν•΄ μƒμΉκ³Ό ν•λ½μ μƒλ€μ μΈ κ°•λ„λ¥Ό λ‚νƒ€λ‚Έ μ§€ν‘λ΅μ¨, μΌλ°μ μΌλ΅ RSIκ°€ 70 μ΄μƒμΌ κ²½μ° κ³Όλ§¤μ κµ¬κ°„μΌλ΅μ¨ λ§¤λ„ν•  λ•λ¥Ό, 30 μ΄ν•μΌ κ²½μ° κ³Όλ§¤λ„ κµ¬κ°„μΌλ΅μ¨ λ§¤μν•΄μ•Ό ν•  λ•λ΅ μ—¬κ²¨μ§‘λ‹λ‹¤. μ΄μ— λ€ν• λ°±ν…μ¤νΈλ¥Ό μ‹¤ν–‰ν•΄λ³΄λ„λ΅ ν•κ² μµλ‹λ‹¤.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">talib</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">prices</span><span class="p">[[</span><span class="s1">&#39;SPY&#39;</span><span class="p">]]</span>
<span class="n">spy_rsi</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">talib</span><span class="o">.</span><span class="n">RSI</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">14</span><span class="p">))</span>

<span class="n">signal</span> <span class="o">=</span> <span class="n">spy_rsi</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">signal</span><span class="p">[</span><span class="n">spy_rsi</span> <span class="o">&gt;</span> <span class="mi">70</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">signal</span><span class="p">[</span><span class="n">spy_rsi</span> <span class="o">&lt;</span> <span class="mi">30</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">signal</span><span class="p">[(</span><span class="n">spy_rsi</span> <span class="o">&lt;=</span> <span class="mi">70</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">spy_rsi</span> <span class="o">&gt;=</span> <span class="mi">30</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">signal</span><span class="p">[</span><span class="n">signal</span><span class="o">.</span><span class="n">isnull</span><span class="p">()]</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
</div>
<p>λ¨Όμ € <code class="docutils literal notranslate"><span class="pre">apply()</span></code> ν•¨μ λ‚΄λ¶€μ— <code class="docutils literal notranslate"><span class="pre">RSI()</span></code>μ„ μ΄μ©ν•΄ 14μΌ κΈ°μ¤€ RSIλ¥Ό κµ¬ν•©λ‹λ‹¤. κ·Έ ν›„ RSIκ°€ 70μ„ μ΄κ³Όν•λ©΄ -1(μ ν¬μ§€μ…), 30 λ―Έλ§μ΄λ©΄ 1(λ΅± ν¬μ§€μ…), 30κ³Ό 70 μ‚¬μ΄λ©΄ 0(λ‰΄νΈλ΄)μΈ μ‹ νΈλ¥Ό λ§λ“­λ‹λ‹¤.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">gridspec</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">sharex</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="n">nrows</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">ncols</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

<span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;SPY&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">([])</span>

<span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">spy_rsi</span><span class="p">[</span><span class="s1">&#39;SPY&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">ylim</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">])</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="mi">70</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/16_backtest_93_0.png" src="_images/16_backtest_93_0.png" />
</div>
</div>
<p>μ„ κ·Έλν”„λ” μ£Όκ°€λ¥Ό λ‚νƒ€λ‚΄λ©°, μ•„λ κ·Έλν”„λ” RSIλ¥Ό λ‚νƒ€λƒ…λ‹λ‹¤. μ΄μ  λ§λ“¤μ–΄μ§„ μ‹ νΈλ¥Ό λ°”νƒ•μΌλ΅ λ°±ν…μ¤νΈλ¥Ό μ‹¤ν•»ν•΄λ³΄κ² μµλ‹λ‹¤.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">strategy</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">Strategy</span><span class="p">(</span><span class="s1">&#39;RSI_MeanReversion&#39;</span><span class="p">,</span> 
                       <span class="p">[</span><span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">WeighTarget</span><span class="p">(</span><span class="n">signal</span><span class="p">),</span>
                        <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">Rebalance</span><span class="p">()])</span>
<span class="n">backtest</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">Backtest</span><span class="p">(</span><span class="n">strategy</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">backtest</span><span class="p">)</span>

<span class="n">result</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/16_backtest_95_0.png" src="_images/16_backtest_95_0.png" />
</div>
</div>
<p>RSIλ¥Ό μ΄μ©ν•μ—¬ νΈλ μ΄λ”©μ„ ν•  κ²½μ° μ¥κΈ°κ°„μΌλ΅ ν° μ†μ‹¤μ—†μ΄ μ μ‘λ™ν•μ§€λ§, κ³Όλ§¤μ νΉμ€ κ³Όλ§¤λ„λ΅ μΈν• ν¬μ μ‹ νΈκ°€ λ‚νƒ€λ‚λ” κ²½μ°κ°€ λ“λ¬Όμ–΄ λ„μ μμµλ¥  μμ²΄λ„ κ·Έλ ‡κ² λ†’μ§€ μ•μµλ‹λ‹¤. λ°λ©΄ 2020λ…„μ κ²½μ° μ¶”μ„Έμ¶”μΆ… μ „λµκ³Όλ” λ°λ€λ΅ 3μ›” κΈ‰λ½μ¥μ—μ„ κ³Όλ§¤λ„ μ‹ νΈλ΅ μΈν•΄ λ§¤μλ¥Ό ν•¨μΌλ΅μ¨, λ°λ“±μΌλ΅ μΈν•΄ μƒλ‹Ήν• μμµμ„ κ±°λ‘κΈ°λ„ ν•©λ‹λ‹¤. μ΄μ²λΌ μ¶”μ„Έμ¶”μΆ…κ³Ό ν‰κ· νκ·€λ” μ„λ΅ μƒλ°λ„ νΉμ§•μ΄ μμΌλ―€λ΅, μ΄λ¥Ό μ μ΅°ν•©ν•λ©΄ ν›¨μ”¬ μ•μ •μ μΈ μμµμ„ κ±°λ‘ μ μλ” νΈλ μ΄λ”© μ „λµμ„ κ°λ°ν•  μλ„ μμµλ‹λ‹¤.</p>
</div>
<div class="section" id="id16">
<h3>16.5.2 λ³Όλ¦°μ € λ°΄λ“λ¥Ό μ΄μ©ν• μ „λµ<a class="headerlink" href="#id16" title="Permalink to this headline">Β¶</a></h3>
<p>μ΄λ²μ—λ” λ³Όλ¦°μ € λ°΄λ“λ¥Ό μ΄μ©ν• ν‰κ· νκ·€ μ „λµμ„ λ°±ν…μ¤νΈ ν•΄λ³΄λ„λ΅ ν•κ² μµλ‹λ‹¤. λ³Όλ¦°μ €λ°΄λ“λ” μ΄λ™ν‰κ· μ„ μ„ μ¤‘μ‹¬μΌλ΅ μΌμ • ν‘μ¤€νΈμ°¨λ¥Ό μƒν•μ„ κ³Ό ν•ν•μ„ μΌλ΅ μ„¤μ •ν• λ°΄λ“μ…λ‹λ‹¤. μ£Όκ°€κ°€ μ •κ·λ¶„ν¬λ¥Ό λ”°λ¥Έλ‹¤λ©΄ μ£Όκ°€μ μ›€μ§μ„μ€ μƒν•μ„ κ³Ό ν•ν•μ„ μΌλ΅ κµ¬μ„±λ λ°΄λ“ λ‚΄μ—μ„λ§ μ›€μ§μΌ ν™•λ¥ μ΄ λ†’μµλ‹λ‹¤. λ”°λΌμ„ μ£Όκ°€κ°€ μƒν•μ„  μ„μ— μλ‹¤λ” κ²ƒμ€ κ³Όλ§¤μ μƒνƒμ΄λ―€λ΅ ν•λ½ν•  κ°€λ¥μ„±μ΄ λ†’μΌλ¥΄λ΅ μ ν¬μ§€μ…μ„, ν•λ‹¨μ„  μ•„λμ— μλ‹¤λ” κ²ƒμ€ κ³Όλ§¤λ„ μƒνƒμ΄λ―€λ΅ μƒμΉν•  κ°€λ¥μ„±μ΄ λ†’μΌλ―€λ΅ λ΅± ν¬μ§€μ…μ„ μ·¨ν•©λ‹λ‹¤.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">upper_2sd</span><span class="p">,</span> <span class="n">mid_2sd</span><span class="p">,</span> <span class="n">lower_2sd</span> <span class="o">=</span> <span class="n">talib</span><span class="o">.</span><span class="n">BBANDS</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;SPY&#39;</span><span class="p">],</span>
                                             <span class="n">nbdevup</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
                                             <span class="n">nbdevdn</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
                                             <span class="n">timeperiod</span> <span class="o">=</span> <span class="mi">20</span><span class="p">)</span>

<span class="n">bb</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">upper_2sd</span><span class="p">,</span> <span class="n">mid_2sd</span><span class="p">,</span> <span class="n">lower_2sd</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;SPY&#39;</span><span class="p">]],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">bb</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Upper Band&#39;</span><span class="p">,</span> <span class="s1">&#39;Mid Band&#39;</span><span class="p">,</span> <span class="s1">&#39;Lower Band&#39;</span><span class="p">,</span> <span class="s1">&#39;SPY&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">BBANDS()</span></code> ν•¨μλ¥Ό μ΄μ©ν•΄ 20μΌ κΈ°μ¤€ 2 ν‘μ¤€νΈμ°¨μ— ν•΄λ‹Ήν•λ” λ³Όλ¦°μ € λ°΄λ“μ μƒ, μ¤‘, ν•λ‹¨ κ°’μ„ κ³„μ‚°ν• ν›„ ν•λ‚μ λ°μ΄ν„°ν”„λ μ„μΌλ΅ λ¬¶μ–΄μ¤λ‹λ‹¤.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">signal</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">signal</span><span class="p">[</span><span class="s1">&#39;SPY&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

<span class="n">signal</span><span class="p">[</span><span class="n">bb</span><span class="p">[</span><span class="s1">&#39;SPY&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">bb</span><span class="p">[</span><span class="s1">&#39;Upper Band&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">signal</span><span class="p">[</span><span class="n">bb</span><span class="p">[</span><span class="s1">&#39;SPY&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">bb</span><span class="p">[</span><span class="s1">&#39;Lower Band&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">signal</span><span class="p">[</span><span class="n">signal</span><span class="o">.</span><span class="n">isnull</span><span class="p">()]</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
</div>
<p>μ£Όκ°€κ°€ μƒν•μ„  μ„μ— μμ„ κ²½μ° -1(μ ν¬μ§€μ…), μ£Όκ°€κ°€ ν•ν•μ„  μ•„λμ— μμ„ κ²½μ° 1(λ΅± ν¬μ§€μ…), κ·Έ μ™Έμ κ²½μ° 0(λ‰΄νΈλ΄)μ μ‹ νΈλ¥Ό λ§λ“­λ‹λ‹¤. ν•΄λ‹Ή μ‹ νΈλ¥Ό λ°”νƒ•μΌλ΅ λ°±ν…μ¤νΈλ¥Ό μ‹¤ν•»ν•΄λ³΄κ² μµλ‹λ‹¤.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">strategy</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">Strategy</span><span class="p">(</span><span class="s1">&#39;BB&#39;</span><span class="p">,</span> 
                       <span class="p">[</span><span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">WeighTarget</span><span class="p">(</span><span class="n">signal</span><span class="p">),</span>
                        <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">Rebalance</span><span class="p">()])</span>
<span class="n">backtest</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">Backtest</span><span class="p">(</span><span class="n">strategy</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">backtest</span><span class="p">)</span>

<span class="n">result</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/16_backtest_103_0.png" src="_images/16_backtest_103_0.png" />
</div>
</div>
<p>RSIμ™€ λ§μ°¬κ°€μ§€λ΅ 0λ³Όλ¦°μ €λ°΄λ“λ¥Ό μ΄μ©ν• ν‰κ· νκ·€ νΈλ μ΄λ”©μ„ ν•  κ²½μ°μ—λ„ μ¥κΈ°κ°„μΌλ΅ ν° μ†μ‹¤μ—†μ΄ μ μ‘λ™ν•©λ‹λ‹¤. λν• RSI λ€λΉ„ ν¬μ μ‹ νΈλ„ μμ£Ό λ°μƒν•΄ λ„μ  μμµλ¥  μ—­μ‹ λ†’μµλ‹λ‹¤.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>μ„μ—μ„ λ°±ν…μ¤νΈν• μ¶”μ„Έμ¶”μΆ…κ³Ό ν‰κ· νκ·€ μ „λµμ κ²½μ° μ‹ νΈκ°€ λ°μƒν•λ©΄ ν•΄λ‹ΉμΌ μΆ…κ°€μ— ν¬μ§€μ…μ„ μ·¨ν•λ‹¤κ³  κ°€μ •ν–μµλ‹λ‹¤. κ·Έλ¬λ‚ ν„μ‹¤μ—μ„λ” μΆ…κ°€ μ§μ „κΉμ§€ λ°μƒν• μ‹ νΈλ¥Ό λ°”νƒ•μΌλ΅ μΆ…κ°€μ— λ§¤λ§¤λ¥Ό ν•κ±°λ‚ μΆ…κ°€λ΅ κ³„μ‚°λ μ‹ νΈλ¥Ό λ°”νƒ•μΌλ΅ λ‹¤μλ‚  μ‹κ°€μ— λ§¤λ§¤λ¥Ό ν•΄μ•Όν•λ―€λ΅, λ°±ν…μ¤νΈμ μμµλ¥ κ³Ό μ‹¤μ  μμµλ¥ μ€ μƒλ‹Ήν μ°¨μ΄κ°€ μμ„ μ μμµλ‹λ‹¤. λ§¤λ§¤μμλ£μ κ²½μ°λ„ λ°±ν…μ¤νΈμ μμµλ¥ κ³Ό μ‹¤μ  μμµλ¥ κ°„ μ°¨μ΄λ¥Ό λ°μƒμ‹ν‚¤λ” μ›μΈμ΄ λ  μ μμ§€λ§, μ„ λ¬Όμ„ μ΄μ©ν•  κ²½μ° μμλ£λ‚ μ‹μ¥ μ¶©κ²©μ€ κ±°μ μ—†λ‹¤κ³  λ΄λ„ λ¬΄λ°©ν•©λ‹λ‹¤.</p>
</div>
</div>
</div>
<div class="section" id="target-volatility">
<h2>16.6 νƒ€κ² λ³Ό(Target Volatility) μ „λµ<a class="headerlink" href="#target-volatility" title="Permalink to this headline">Β¶</a></h2>
<ol class="simple">
<li><p>λ³€λ™μ„±κ³Ό μμµλ¥ μ μ—­κ΄€κ³„ (https://papers.ssrn.com/sol3/papers.cfm?abstract_id=709623</p></li>
<li><p>volatility clustering</p></li>
</ol>
<p>https://quantpedia.com/an-introduction-to-volatility-targeting/</p>
<div class="section" id="id17">
<h3>16.6.1 νƒ€κ²λ³Ό κµ¬ν„ν•κΈ°<a class="headerlink" href="#id17" title="Permalink to this headline">Β¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">prices</span><span class="p">[[</span><span class="s1">&#39;SPY&#39;</span><span class="p">]]</span>
<span class="n">vol</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">vol</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>SPY    0.19955
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="k">matplotlib</span> inline

<span class="n">roll_std</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pct_change</span><span class="p">()</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>
<span class="n">roll_std</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Rolling Std&#39;</span><span class="p">]</span>

<span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">data</span><span class="p">,</span> <span class="n">roll_std</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.7</span><span class="p">,</span>
                                           <span class="n">secondary_y</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Rolling Std&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="n">vol</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/16_backtest_109_0.png" src="_images/16_backtest_109_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">bt</span>

<span class="n">tv</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">Strategy</span><span class="p">(</span><span class="s1">&#39;Target Vol&#39;</span><span class="p">,</span>
                 <span class="p">[</span><span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">SelectAll</span><span class="p">(),</span>                                    
                  <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">WeighEqually</span><span class="p">(),</span>                  
                  <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">TargetVol</span><span class="p">(</span><span class="mf">0.20</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">months</span> <span class="o">=</span> <span class="mi">1</span><span class="p">),</span> <span class="n">lag</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)),</span>
                  <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">RunWeekly</span><span class="p">(),</span>
                  <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">Rebalance</span><span class="p">()])</span>
<span class="n">tv_backtest</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">Backtest</span><span class="p">(</span><span class="n">tv</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
<span class="n">tv_result</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">tv_backtest</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tv_vol</span> <span class="o">=</span> <span class="n">tv_result</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">to_returns</span><span class="p">()</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>
<span class="n">tv_wt</span> <span class="o">=</span> <span class="n">tv_result</span><span class="o">.</span><span class="n">get_security_weights</span><span class="p">()</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tv_vol</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Target Vol&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">roll_std</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Buy and Hold&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="mf">0.20</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Rolling Std&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tv_wt</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Leverage Ratio&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/16_backtest_111_0.png" src="_images/16_backtest_111_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ret_bind</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">data</span><span class="p">,</span> <span class="n">tv_result</span><span class="o">.</span><span class="n">prices</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">rebase</span><span class="p">()</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ret_bind</span><span class="p">[[</span><span class="s1">&#39;Target Vol&#39;</span><span class="p">]],</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Target Vol&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ret_bind</span><span class="p">[[</span><span class="s1">&#39;SPY&#39;</span><span class="p">]],</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Buy and Hold&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;lower right&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Cumulative Return&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ret_bind</span><span class="o">.</span><span class="n">to_drawdown_series</span><span class="p">(),</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Leverage Ratio&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Drawdown&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/16_backtest_112_0.png" src="_images/16_backtest_112_0.png" />
</div>
</div>
</div>
<div class="section" id="id18">
<h3>16.6.2 μΊ΅ μ”μ°κΈ°<a class="headerlink" href="#id18" title="Permalink to this headline">Β¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tv_wt</span> <span class="o">=</span> <span class="n">tv_result</span><span class="o">.</span><span class="n">get_security_weights</span><span class="p">()</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">tv_wt</span><span class="p">[</span><span class="n">tv_wt</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">tv_wt</span><span class="p">[</span><span class="n">tv_wt</span> <span class="o">&lt;=</span> <span class="mf">0.5</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tv_cap</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">Strategy</span><span class="p">(</span><span class="s1">&#39;Target Vol (Cap)&#39;</span><span class="p">,</span>
                 <span class="p">[</span><span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">WeighTarget</span><span class="p">(</span><span class="n">tv_wt</span><span class="p">),</span>                    
                  <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">RunWeekly</span><span class="p">(),</span>
                  <span class="n">bt</span><span class="o">.</span><span class="n">algos</span><span class="o">.</span><span class="n">Rebalance</span><span class="p">()])</span>
<span class="n">tv_backtest_cap</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">Backtest</span><span class="p">(</span><span class="n">tv_cap</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
<span class="n">tv_result_cap</span> <span class="o">=</span> <span class="n">bt</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">tv_backtest_cap</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ret_bind_cap</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">data</span><span class="p">,</span> <span class="n">tv_result_cap</span><span class="o">.</span><span class="n">prices</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">rebase</span><span class="p">()</span>
<span class="n">tv_vol_cap</span> <span class="o">=</span> <span class="n">tv_result_cap</span><span class="o">.</span><span class="n">prices</span><span class="o">.</span><span class="n">to_returns</span><span class="p">()</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>
<span class="n">tv_wt_cap</span> <span class="o">=</span> <span class="n">tv_result_cap</span><span class="o">.</span><span class="n">get_security_weights</span><span class="p">()</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ret_bind_cap</span><span class="p">[[</span><span class="s1">&#39;Target Vol (Cap)&#39;</span><span class="p">]],</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Target Vol (Cap)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ret_bind_cap</span><span class="p">[[</span><span class="s1">&#39;SPY&#39;</span><span class="p">]],</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Buy and Hold&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;lower right&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Cumulative Return&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ret_bind_cap</span><span class="o">.</span><span class="n">to_drawdown_series</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Drawdown&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tv_vol_cap</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="mf">0.20</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Rolling Std&#39;</span><span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tv_wt_cap</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span> <span class="o">=</span> <span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Leverage Ratio&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/16_backtest_116_0.png" src="_images/16_backtest_116_0.png" />
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="15_trading.html" title="previous page">15. νΈλ μ΄λ”© μ „λµμ„ μ„ν• κΈ°μ μ  μ§€ν‘</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By μ΄ν„μ—΄<br/>
        
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    
  <script src="_static/js/index.d3f166471bb80abb5163.js"></script>


    
  </body>
</html>